[tools]
"npm:markdownlint-cli" = "latest"
"npm:@ansible/ansible-language-server" = "latest"
"npm:@modelcontextprotocol/server-github" = "latest"
pipx = "latest"
"pipx:ansible-lint" = "latest"
"go:github.com/steveyegge/beads/cmd/bd" = "latest"
github-cli = "latest"
"pipx:beads-mcp" = "latest"

[tasks.install-collections]
description = "Install ansible collections"
run = "ansible-galaxy install -r requirements.yml"

[tasks.apply-local]
description = "Apply configuration to the current host locally"
run = "ansible-playbook local.yml -l \"$(hostname)\" -c local"

[tasks.dry-run-local]
description = "Dry run (check mode) configuration on the current host locally with diffs"
run = "ansible-playbook local.yml -l \"$(hostname)\" -c local --check --diff"

[tasks.get-ansible-facts]
description = "List ansible facts"
run = "ansible \"$(hostname)\" -c local -m setup"

[tasks.lint]
description = "Run linters (ansible-lint, markdownlint, bd lint)"
depends = ["lint:ansible", "lint:markdown", "lint:beads"]

[tasks."lint:ansible"]
run = "ansible-lint"

[tasks."lint:markdown"]
run = "markdownlint ."

[tasks."lint:beads"]
run = "bd lint"

[tasks.test]
description = "Run tests for all roles (dry-run)"
run = "ansible-playbook test_all.yml -i hosts -l localhost -c local --check -e \"zerotier_network_id=0000000000000000 github_token=dummytoken\""
