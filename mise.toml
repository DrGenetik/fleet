[tools]
"npm:markdownlint-cli" = "latest"
"npm:@ansible/ansible-language-server" = "latest"
"npm:@modelcontextprotocol/server-github" = "latest"
pipx = "latest"
"pipx:ansible-lint" = "latest"
"go:github.com/steveyegge/beads/cmd/bd" = "latest"
1password-cli = "latest"
github-cli = "latest"

[tasks.install-collections]
description = "Install ansible collections"
run = "ansible-galaxy install -r requirements.yml"

[tasks.apply-local]
description = "Apply configuration to the current host locally"
run = "ansible-playbook local.yml -l \"$(hostname)\" -c local"

[tasks.dry-run-local]
description = "Dry run (check mode) configuration on the current host locally with diffs"
run = "ansible-playbook local.yml -l \"$(hostname)\" -c local --check --diff"

[tasks.get-ansible-facts]
description = "List ansible facts"
run = "ansible \"$(hostname)\" -c local -m setup"

[tasks.lint]
description = "Run linters (ansible-lint, markdownlint)"
depends = ["lint:ansible", "lint:markdown"]

[tasks."lint:ansible"]
run = "ansible-lint"

[tasks."lint:markdown"]
run = "markdownlint ."

[tasks."secrets:view"]
description = "View vaulted secrets"
run = "ansible-vault view group_vars/all/secrets.yml"

[tasks."secrets:edit"]
description = "Edit vaulted secrets"
run = "ansible-vault edit group_vars/all/secrets.yml"

[tasks."secrets:rekey"]
description = "Rekey the vault with a new password"
run = "ansible-vault rekey group_vars/all/secrets.yml"
