{"id":"fleet-00d","title":"Test auto-pairing workflow on subset of hosts","description":"Test the complete auto-pairing workflow on a subset of hosts to validate device ID collection, storage, and config application.\n\n## Testing Approach\n\n1. **Test Device ID Collection**:\n   ```bash\n   ansible-playbook syncthing_autopair.yml --tags collect -l rincewind,constantine --check\n   ansible-playbook syncthing_autopair.yml --tags collect -l rincewind,constantine\n   ```\n\n2. **Test 1Password Storage**:\n   ```bash\n   op read \"op://ServiceAccountAccess/Syncthing Fleet Device IDs/rincewind\"\n   op read \"op://ServiceAccountAccess/Syncthing Fleet Device IDs/constantine\"\n   ```\n\n3. **Test Config Loading**:\n   ```bash\n   ansible-playbook syncthing_autopair.yml --tags configure -l rincewind --check\n   ```\n\n4. **Test Config Application**:\n   ```bash\n   ansible-playbook syncthing_autopair.yml --tags configure -l rincewind,constantine\n   ```\n\n5. **Verify Pairing**:\n   - Open Syncthing GUI on rincewind: http://localhost:8384\n   - Check \"Remote Devices\" section\n   - Verify constantine appears and connects\n   - Repeat verification on constantine\n\n6. **Test Idempotency**:\n   ```bash\n   ansible-playbook syncthing_autopair.yml -l rincewind,constantine\n   ansible-playbook syncthing_autopair.yml -l rincewind,constantine\n   # Second run should show \"ok\" with no changes\n   ```\n\n## Acceptance Criteria\n\n- Device IDs successfully collected from test hosts\n- Device IDs stored in 1Password vault\n- Config.xml templated and applied to test hosts\n- Syncthing services restarted automatically\n- Devices show as \"Connected\" in web GUI\n- Playbook is idempotent (second run shows no changes)\n- No ansible-lint warnings or errors\n- Backup config.xml files created before changes\n- XML validation passes on all generated configs\n- mise run syncthing:autopair completes successfully","acceptance_criteria":"- [ ] Collection phase tested: ansible-playbook with --check shows device IDs would be collected\n- [ ] Collection phase tested: execution mode successfully collects device IDs\n- [ ] Storage phase tested: device IDs successfully written to 1Password vault\n- [ ] Storage phase verified: op read command returns stored device IDs\n- [ ] Config loading tested: device IDs successfully loaded from 1Password into hostvars\n- [ ] Config application tested: templated config applied to test hosts (rincewind, constantine)\n- [ ] Service restart verified: Syncthing services restart after config change\n- [ ] Connectivity verified: Syncthing web GUI shows peer connections\n- [ ] Idempotency tested: second playbook run shows no changes (changed=0)\n- [ ] End-to-end tested: mise run syncthing:autopair completes successfully on test hosts\n- [ ] Backup verification: config.xml.backup files created before changes\n- [ ] XML validation: generated config files pass xmllint validation","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:28:56.787806519-08:00","updated_at":"2026-01-27T15:09:18.390339927-08:00","labels":["syncthing","testing","validation"],"dependencies":[{"issue_id":"fleet-00d","depends_on_id":"fleet-2w0","type":"blocks","created_at":"2026-01-27T14:28:56.805900802-08:00","created_by":"daemon"},{"issue_id":"fleet-00d","depends_on_id":"fleet-nz6","type":"blocks","created_at":"2026-01-27T14:29:11.994055708-08:00","created_by":"daemon"},{"issue_id":"fleet-00d","depends_on_id":"fleet-2w0","type":"parent-child","created_at":"2026-01-27T14:51:35.30955904-08:00","created_by":"daemon"}]}
{"id":"fleet-0g5","title":"Store collected device IDs in 1Password vault","description":"Create Ansible task to populate 1Password vault with collected device IDs from all hosts.\n\n## Implementation\n\nCreate `roles/syncthing/tasks/store_device_ids.yml`:\n\n```yaml\n# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\n---\n- name: \"Syncthing | Store device ID in 1Password\"\n  ansible.builtin.command:\n    cmd: \u003e\n      op item edit \"Syncthing Fleet Device IDs\"\n      {{ inventory_hostname }}[text]=\"{{ syncthing_device_id }}\"\n  delegate_to: localhost\n  run_once: false\n  changed_when: true\n  register: op_result\n  failed_when: op_result.rc != 0\n```\n\nPlaybook integration:\n```yaml\n- name: \"Collect and store Syncthing device IDs\"\n  hosts: laptop:workstation\n  tasks:\n    - name: \"Include device ID collection\"\n      ansible.builtin.include_role:\n        name: syncthing\n        tasks_from: collect_device_ids.yml\n    \n    - name: \"Include device ID storage\"\n      ansible.builtin.include_role:\n        name: syncthing\n        tasks_from: store_device_ids.yml\n```\n\n## Acceptance Criteria\n\n- Task file created using ansible.builtin.command for op CLI\n- Task runs on localhost (delegate_to) but processes all hosts\n- Device IDs successfully stored in 1Password vault\n- Verification: `op read \"op://ServiceAccountAccess/Syncthing Fleet Device IDs/\u003chostname\u003e\"` returns device ID\n- Task is idempotent (updates existing fields)\n- Follows FQCN convention and copyright header\n- `ansible-lint` passes","acceptance_criteria":"- [ ] Ansible task created to store device IDs in 1Password\n- [ ] Task runs on localhost (control node) with `delegate_to: localhost`\n- [ ] Uses `ansible.builtin.command` to run `op item edit` for each host's device ID\n- [ ] Loops over hostvars to update all collected device IDs\n- [ ] Command structure: `op item edit \"Syncthing Fleet Device IDs\" {{ inventory_hostname }}=\"{{ syncthing_device_id }}\"`\n- [ ] Task marked `changed_when: false` or detects actual changes\n- [ ] Task includes error handling for op CLI failures\n- [ ] Test run successfully stores device IDs for test hosts (rincewind, constantine)\n- [ ] Verification: `op read \"op://ServiceAccountAccess/Syncthing Fleet Device IDs/rincewind\"` returns correct device ID","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:28:09.952879137-08:00","updated_at":"2026-01-27T14:56:47.513667248-08:00","labels":["1password","secrets-management","syncthing"],"dependencies":[{"issue_id":"fleet-0g5","depends_on_id":"fleet-2w0","type":"blocks","created_at":"2026-01-27T14:28:09.957966723-08:00","created_by":"daemon"},{"issue_id":"fleet-0g5","depends_on_id":"fleet-st4","type":"blocks","created_at":"2026-01-27T14:29:06.462394691-08:00","created_by":"daemon"},{"issue_id":"fleet-0g5","depends_on_id":"fleet-69s","type":"blocks","created_at":"2026-01-27T14:29:06.841938283-08:00","created_by":"daemon"},{"issue_id":"fleet-0g5","depends_on_id":"fleet-2w0","type":"parent-child","created_at":"2026-01-27T14:51:31.825912611-08:00","created_by":"daemon"}]}
{"id":"fleet-0mw","title":"Add Syncthing connection type verification via API","description":"Create task to verify Syncthing is using direct connections (not relay) via REST API.\n\n## Implementation\n\nCreate `roles/syncthing/tasks/verify_connection_type.yml`:\n\n```yaml\n# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\n---\n- name: \"Syncthing | Get API key from config\"\n  ansible.builtin.slurp:\n    src: \"{{ syncthing_config_dir }}/config.xml\"\n  register: syncthing_config_raw\n  when: syncthing_verify_connections | default(false)\n\n- name: \"Syncthing | Parse API key from config\"\n  ansible.builtin.set_fact:\n    syncthing_api_key: \"{{ (syncthing_config_raw.content | b64decode | regex_search('\u003capikey\u003e(.*?)\u003c/apikey\u003e', '\\\\1'))[0] }}\"\n  when: syncthing_verify_connections | default(false)\n\n- name: \"Syncthing | Get device connections status\"\n  ansible.builtin.uri:\n    url: \"http://127.0.0.1:8384/rest/system/connections\"\n    headers:\n      X-API-Key: \"{{ syncthing_api_key }}\"\n    method: GET\n    return_content: true\n  register: syncthing_connections\n  when: syncthing_verify_connections | default(false)\n  retries: 3\n  delay: 5\n\n- name: \"Syncthing | Check for relay connections\"\n  ansible.builtin.set_fact:\n    relay_connections: \u003e-\n      {{\n        syncthing_connections.json.connections.values()\n        | selectattr('type', 'search', 'relay')\n        | list\n      }}\n  when: syncthing_verify_connections | default(false)\n\n- name: \"Syncthing | Report connection types\"\n  ansible.builtin.debug:\n    msg: |\n      Connected devices: {{ syncthing_connections.json.connections | length }}\n      Direct connections: {{ syncthing_connections.json.connections.values() | selectattr('type', 'ne', 'relay-*') | list | length }}\n      Relay connections: {{ relay_connections | length }}\n  when: syncthing_verify_connections | default(false)\n\n- name: \"Syncthing | Warn if relay connections detected\"\n  ansible.builtin.debug:\n    msg: \"WARNING: {{ relay_connections | length }} device(s) using relay connections. Check firewall configuration.\"\n  when:\n    - syncthing_verify_connections | default(false)\n    - relay_connections | length \u003e 0\n```\n\nIntegration in `roles/syncthing/tasks/main.yml`:\n```yaml\n- name: \"Verify connection types\"\n  ansible.builtin.include_tasks: verify_connection_type.yml\n  when: syncthing_verify_connections | default(false)\n  tags: ['verify', 'connectivity']\n```\n\nAdd to `roles/syncthing/defaults/main.yml`:\n```yaml\nsyncthing_verify_connections: false  # Disabled by default\nsyncthing_config_dir: \"{{ ansible_env.HOME }}/.config/syncthing\"\n```\n\n## Connection Types\n\nSyncthing reports connection types in the API:\n- `tcp-client` or `tcp-server` - Direct TCP connection (optimal)\n- `quic-client` or `quic-server` - Direct QUIC connection (optimal)\n- `relay-*` - Relay server connection (suboptimal, indicates firewall issue)","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] Task file `roles/syncthing/tasks/verify_connection_type.yml` created\n- [ ] Task queries Syncthing REST API endpoint /rest/system/connections\n- [ ] API key extracted from config.xml using ansible.builtin.slurp\n- [ ] Connection types parsed for each connected peer\n- [ ] Task warns (not fails) if relay connections detected\n- [ ] Task reports count of direct vs relay connections\n- [ ] Variable `syncthing_verify_connections` added to defaults (default: false)\n- [ ] Task integrated into main.yml with conditional\n- [ ] Copyright header present\n- [ ] `ansible-lint` passes\n- [ ] `mise run lint` passes","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:46:40.486574047-08:00","updated_at":"2026-01-27T19:33:41.500883095-08:00","labels":["api","syncthing","testing","validation"],"dependencies":[{"issue_id":"fleet-0mw","depends_on_id":"fleet-ccd","type":"blocks","created_at":"2026-01-27T14:46:40.504376943-08:00","created_by":"daemon"},{"issue_id":"fleet-0mw","depends_on_id":"fleet-ccd","type":"parent-child","created_at":"2026-01-27T14:49:03.519186821-08:00","created_by":"daemon"},{"issue_id":"fleet-0mw","depends_on_id":"fleet-9ia","type":"parent-child","created_at":"2026-01-27T15:13:52.650774822-08:00","created_by":"daemon"},{"issue_id":"fleet-0mw","depends_on_id":"fleet-err","type":"parent-child","created_at":"2026-01-27T15:13:53.297535684-08:00","created_by":"daemon"},{"issue_id":"fleet-0mw","depends_on_id":"fleet-33f","type":"parent-child","created_at":"2026-01-27T15:17:19.017415251-08:00","created_by":"daemon"},{"issue_id":"fleet-0mw","depends_on_id":"fleet-in2","type":"parent-child","created_at":"2026-01-27T15:17:19.513032297-08:00","created_by":"daemon"}]}
{"id":"fleet-11m","title":"Create integration test for Syncthing firewall configuration","description":"Create comprehensive integration test to verify complete firewall configuration workflow.\n\n## Implementation\n\nCreate `roles/syncthing/tests/test_firewall.yml`:\n\n```yaml\n# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\n---\n- name: \"Test Syncthing Firewall Configuration\"\n  hosts: localhost\n  connection: local\n  gather_facts: true\n  \n  tasks:\n    - name: \"Include firewall configuration tasks\"\n      ansible.builtin.include_role:\n        name: syncthing\n        tasks_from: \"{{ ansible_facts.system | lower }}_configure_firewall.yml\"\n      when: ansible_facts.system in ['Linux', 'Darwin']\n\n    - name: \"Validate firewall rules (Linux)\"\n      ansible.builtin.command: ufw status verbose\n      register: ufw_status\n      changed_when: false\n      become: true\n      when: ansible_facts.system == \"Linux\"\n\n    - name: \"Check TCP 22000 rule exists (Linux)\"\n      ansible.builtin.assert:\n        that:\n          - \"'22000/tcp' in ufw_status.stdout\"\n          - \"'Syncthing sync protocol (TCP)' in ufw_status.stdout\"\n        fail_msg: \"TCP 22000 firewall rule not found\"\n      when: ansible_facts.system == \"Linux\"\n\n    - name: \"Check UDP 22000 rule exists (Linux)\"\n      ansible.builtin.assert:\n        that:\n          - \"'22000/udp' in ufw_status.stdout\"\n          - \"'Syncthing sync protocol (QUIC)' in ufw_status.stdout\"\n        fail_msg: \"UDP 22000 firewall rule not found\"\n      when: ansible_facts.system == \"Linux\"\n\n    - name: \"Check UDP 21027 rule exists (Linux)\"\n      ansible.builtin.assert:\n        that:\n          - \"'21027/udp' in ufw_status.stdout\"\n          - \"'Syncthing local discovery' in ufw_status.stdout\"\n        fail_msg: \"UDP 21027 firewall rule not found\"\n      when: ansible_facts.system == \"Linux\"\n\n    - name: \"Validate firewall rules (Darwin)\"\n      ansible.builtin.command: /usr/libexec/ApplicationFirewall/socketfilterfw --listapps\n      register: darwin_fw_status\n      changed_when: false\n      become: true\n      when: ansible_facts.system == \"Darwin\"\n\n    - name: \"Check Syncthing in firewall (Darwin)\"\n      ansible.builtin.assert:\n        that:\n          - \"'syncthing' in darwin_fw_status.stdout\"\n        fail_msg: \"Syncthing not found in application firewall\"\n      when: ansible_facts.system == \"Darwin\"\n\n    - name: \"Run port validation\"\n      ansible.builtin.include_role:\n        name: syncthing\n        tasks_from: validate_ports.yml\n      vars:\n        syncthing_validate_ports: true\n\n    - name: \"Report test completion\"\n      ansible.builtin.debug:\n        msg: \"Syncthing firewall configuration test passed\"\n```\n\nUpdate `mise.toml`:\n```toml\n[tasks.\"test:syncthing-firewall\"]\ndescription = \"Test Syncthing firewall configuration\"\nrun = \"ansible-playbook roles/syncthing/tests/test_firewall.yml\"\n```\n\n## Test Coverage\n\n- Firewall rules applied correctly on both Linux and Darwin\n- All three required ports configured (TCP 22000, UDP 22000, UDP 21027)\n- Rules include descriptive comments\n- Ports are listening after configuration\n- Test is idempotent (can run multiple times)\n- Platform-specific validation (ufw vs socketfilterfw)","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] Test file `roles/syncthing/tests/test_firewall.yml` created\n- [ ] Test validates firewall rules on Linux (ufw) hosts\n- [ ] Test validates firewall rules on Darwin (socketfilterfw) hosts\n- [ ] Test confirms TCP port 22000 accessible\n- [ ] Test confirms UDP port 22000 accessible\n- [ ] Test confirms UDP port 21027 accessible\n- [ ] Test is idempotent (can run multiple times)\n- [ ] Test integrated into role test suite\n- [ ] Documentation updated with test usage\n- [ ] `mise run lint` passes\n- [ ] `mise run test` passes","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:47:04.170696823-08:00","updated_at":"2026-01-27T19:33:36.662413413-08:00","labels":["firewall","syncthing","testing"],"dependencies":[{"issue_id":"fleet-11m","depends_on_id":"fleet-ccd","type":"blocks","created_at":"2026-01-27T14:47:04.190837446-08:00","created_by":"daemon"},{"issue_id":"fleet-11m","depends_on_id":"fleet-ccd","type":"parent-child","created_at":"2026-01-27T14:49:04.463992094-08:00","created_by":"daemon"},{"issue_id":"fleet-11m","depends_on_id":"fleet-212","type":"parent-child","created_at":"2026-01-27T15:13:56.722761981-08:00","created_by":"daemon"},{"issue_id":"fleet-11m","depends_on_id":"fleet-lcb","type":"parent-child","created_at":"2026-01-27T15:13:57.342798177-08:00","created_by":"daemon"},{"issue_id":"fleet-11m","depends_on_id":"fleet-l6e","type":"parent-child","created_at":"2026-01-27T15:13:58.024629811-08:00","created_by":"daemon"},{"issue_id":"fleet-11m","depends_on_id":"fleet-4up","type":"parent-child","created_at":"2026-01-27T15:17:21.040453748-08:00","created_by":"daemon"},{"issue_id":"fleet-11m","depends_on_id":"fleet-3ck","type":"parent-child","created_at":"2026-01-27T15:17:21.676783341-08:00","created_by":"daemon"},{"issue_id":"fleet-11m","depends_on_id":"fleet-m94","type":"parent-child","created_at":"2026-01-27T15:17:22.166437174-08:00","created_by":"daemon"}]}
{"id":"fleet-194","title":"Create syncthing role metadata file","description":"Create the `meta/main.yml` file defining role metadata including supported platforms, dependencies, and author information.\n\nReference existing roles for metadata structure.\n\n## Acceptance Criteria\n\n- [ ] `roles/syncthing/meta/main.yml` created with copyright header\n- [ ] Defines role author and description\n- [ ] Specifies supported platforms (Debian, Ubuntu, Darwin)\n- [ ] Includes ansible_version minimum requirement (2.9 or higher)\n- [ ] No role dependencies declared (standalone role)\n- [ ] Follows standard Ansible Galaxy metadata format","acceptance_criteria":"- [ ] `roles/syncthing/meta/main.yml` created with copyright header\n- [ ] Defines role author and description\n- [ ] Specifies supported platforms (Debian, Ubuntu, Darwin)\n- [ ] Includes ansible_version minimum requirement (2.9 or higher)\n- [ ] No role dependencies declared (standalone role)\n- [ ] Follows standard Ansible Galaxy metadata format","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:06:12.002834201-08:00","updated_at":"2026-01-27T14:06:12.002834201-08:00","labels":["syncthing"],"dependencies":[{"issue_id":"fleet-194","depends_on_id":"fleet-c8a","type":"blocks","created_at":"2026-01-27T14:06:16.516072978-08:00","created_by":"daemon"},{"issue_id":"fleet-194","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T14:06:17.04125061-08:00","created_by":"daemon"}]}
{"id":"fleet-212","title":"Create Linux firewall integration test","description":"Create integration test playbook to verify Linux (ufw) firewall configuration for Syncthing.\n\n## Context\nThis is part of firewall integration testing (parent: fleet-11m). Tests Linux-specific firewall configuration.\n\n## Implementation\n\nCreate `roles/syncthing/tests/test_linux_firewall.yml`:\n\n- Test ufw status shows active\n- Test ufw rules include 22000/tcp ALLOW\n- Test ufw rules include 22000/udp ALLOW\n- Test ufw rules include 21027/udp ALLOW\n- Test port listening: netstat or ss shows ports open\n- Test local connectivity: curl to 127.0.0.1:8384\n- Include role and run firewall tasks\n- Verify tasks are idempotent\n\n## Acceptance Criteria\n\n- [ ] test_linux_firewall.yml created in roles/syncthing/tests/\n- [ ] Test runs only on Linux hosts (ansible_facts.system == 'Linux')\n- [ ] Test verifies ufw status is active\n- [ ] Test verifies ufw rules for 22000/tcp\n- [ ] Test verifies ufw rules for 22000/udp\n- [ ] Test verifies ufw rules for 21027/udp\n- [ ] Test verifies ports are listening using netstat or ss\n- [ ] Test verifies Syncthing API is accessible (http://127.0.0.1:8384)\n- [ ] Test includes idempotency check (second run shows no changes)\n- [ ] Copyright header present\n- [ ] ansible-playbook --syntax-check passes\n- [ ] ansible-lint passes","status":"closed","priority":2,"issue_type":"task","owner":"kayos@genetikayos.com","created_at":"2026-01-27T15:13:40.149214731-08:00","created_by":"T.R. Fullhart","updated_at":"2026-01-27T15:39:22.519526904-08:00","closed_at":"2026-01-27T15:39:22.519526904-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["firewall","linux","syncthing","testing"],"dependencies":[{"issue_id":"fleet-212","depends_on_id":"fleet-l6e","type":"blocks","created_at":"2026-01-27T15:13:58.689001184-08:00","created_by":"daemon"}]}
{"id":"fleet-238","title":"mise dry-run-local fails during apt-update","description":"The `mise run dry-run-local` task fails during apt package cache update phase with an error. This blocks local testing and validation workflows.\n\n## Reproduction\n```bash\nmise run dry-run-local\n```\n\n## Expected Behavior\nDry run should complete successfully, showing what changes would be made without applying them.\n\n## Actual Behavior\nTask fails during apt-update with an error (exact error message needs investigation).\n\n## Impact\n- Cannot validate playbook changes locally before applying\n- Blocks testing workflow\n- May indicate issue with apt cache handling in check mode","acceptance_criteria":"- [ ] Root cause identified: which task in local.yml triggers apt-update failure\n- [ ] Error message and stack trace documented in issue notes\n- [ ] Failure reproduced with: `mise run dry-run-local`\n- [ ] Solution implemented (update ansible version, fix apt cache handling, or skip problematic task in check mode)\n- [ ] `mise run dry-run-local` completes successfully without errors\n- [ ] `mise run lint` passes\n- [ ] Changes do not break `mise run apply-local` execution","notes":"Issue was already fixed in commit 0ac1663 on 2026-01-16 by T.R. Fullhart.\n\n**Root Cause**: apt/pacman cache update tasks in local.yml Pre-run Setup play failed during check mode due to permission/locking issues.\n\n**Solution**: Added 'ignore_errors: {{ ansible_check_mode }}' to both apt (line 30) and pacman (line 37) cache update tasks. This allows cache update failures to be ignored in check mode while still failing in normal execution.\n\n**Verification**: Ran 'mise run dry-run-local' successfully on 2026-01-27. PLAY RECAP: ok=38, changed=1, unreachable=0, failed=0, skipped=10.\n\nCommit message: 'fix(local.yml): ignore apt/pacman cache update errors in check mode. Fixes: fleet-238'","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T12:12:46.9752305-08:00","created_by":"kayos","updated_at":"2026-01-27T19:25:22.021754949-08:00","closed_at":"2026-01-27T19:25:22.021754949-08:00","close_reason":"Closed"}
{"id":"fleet-2f4","title":"Configure beads sync branch","description":"bd doctor warned that sync-branch is not configured. Run 'bd migrate sync beads-sync' to set it up.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:24:43.747417918-08:00","created_by":"kayos","updated_at":"2026-01-06T15:33:50.830744583-08:00","closed_at":"2026-01-06T15:33:50.830744583-08:00","close_reason":"Closed"}
{"id":"fleet-2om","title":"Add test task to mise.toml","description":"Create a task in mise.toml to run ansible role tests. This ensures tests can be run easily and consistently, handling path issues correctly.","status":"closed","priority":2,"issue_type":"task","assignee":"kayos","created_at":"2026-01-06T16:05:22.427700534-08:00","created_by":"kayos","updated_at":"2026-01-06T16:08:27.75713178-08:00","closed_at":"2026-01-06T16:08:27.75713178-08:00","close_reason":"Implemented test task in mise.toml"}
{"id":"fleet-2w0","title":"Implement Syncthing auto-pairing with device ID management","description":"Automate Syncthing device pairing across the fleet by collecting device IDs, storing them in 1Password, and templating config.xml files. This eliminates manual GUI-based pairing for new devices and shared folders.\n\n## Background\n\nAfter fleet-4g6 (basic Syncthing installation), devices must be manually paired via the web GUI. For a 5-device fleet, this requires:\n- Accessing each device's web GUI (localhost:8384)\n- Copying device IDs from each host\n- Adding each device ID to every other device's config\n- Accepting folder shares manually\n\nThis epic automates the pairing process using Ansible to template configurations.\n\n## Scope\n\n**In Scope:**\n- Collect Syncthing device IDs from all running instances\n- Store device IDs securely in 1Password vault\n- Template config.xml with full device list on each host\n- Configure shared folder definitions (optional, per-folder basis)\n- Restart Syncthing services to apply config\n- Document device ID generation and pairing mechanism\n\n**Out of Scope:**\n- Firewall configuration (Syncthing uses UPnP, manual config if needed)\n- Pre-generating device certificates and private keys\n- Folder content synchronization (Syncthing handles this)\n- GUI customization (authentication, HTTPS)\n\n## Technical Approach\n\n1. **Device ID Collection**:\n   - Read device ID from each host via REST API: `curl -H \"X-API-Key: ...\" http://localhost:8384/rest/system/status | jq -r .myID`\n   - Alternative: Parse from `~/.config/syncthing/config.xml`\n   - Store mapping: `hostname -\u003e device_id`\n\n2. **1Password Storage Structure**:\n   ```\n   Item Name: \"Syncthing Fleet Device IDs\"\n   Category: Secure Note\n   Fields:\n     - rincewind: DEVICE-ID-HERE\n     - dresden: DEVICE-ID-HERE\n     - caliban: DEVICE-ID-HERE\n     - jareth: DEVICE-ID-HERE\n     - constantine: DEVICE-ID-HERE\n   ```\n\n3. **Config Templating**:\n   - Create Jinja2 template: `roles/syncthing/templates/config.xml.j2`\n   - Loop over all device IDs from vault\n   - Configure devices with `autoAcceptFolders=false` (security)\n   - Define shared folders with device assignments\n   - Use `ansible.builtin.template` module\n\n4. **Service Restart**:\n   - Create handler to restart syncthing@username.service (Linux)\n   - Create handler to restart via launchctl (Darwin)\n   - Notify handler after config.xml changes\n\n## Dependencies\n\n- **Prerequisite**: fleet-4g6 must be complete (Syncthing installed and running)\n- **Prerequisite**: All Syncthing services started at least once (device IDs generated)\n- **Prerequisite**: 1Password CLI authenticated (`op signin`)","acceptance_criteria":"-","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-27T14:27:49.563767997-08:00","updated_at":"2026-01-27T15:45:16.402847371-08:00","labels":["automation","configuration-management","syncthing"],"dependencies":[{"issue_id":"fleet-2w0","depends_on_id":"fleet-4g6","type":"blocks","created_at":"2026-01-27T14:29:13.1712189-08:00","created_by":"daemon"}]}
{"id":"fleet-33f","title":"Create Syncthing API client helper task","description":"## Context\nThis subtask is part of fleet-0mw (Add Syncthing connection type verification via API). It focuses on creating reusable API client infrastructure that can be used by verification tasks.\n\n## Objective\nCreate an Ansible task file that handles Syncthing REST API client setup, including reading API keys from config, constructing base URLs, and testing connectivity.\n\n## Implementation\nCreate `roles/syncthing/tasks/api_client_setup.yml`:\n- Read Syncthing API key from `~/.local/state/syncthing/config.xml`\n- Construct base URL (http://localhost:8384)\n- Test API connectivity with /rest/system/ping\n- Register API key and base URL as facts for reuse\n\n## Acceptance Criteria\n1. Task file created at `roles/syncthing/tasks/api_client_setup.yml`\n2. Uses `ansible.builtin.xml` module to read API key from config.xml\n3. Registers `syncthing_api_key` fact\n4. Registers `syncthing_api_url` fact (default: http://localhost:8384)\n5. Uses `ansible.builtin.uri` to test `/rest/system/ping` endpoint\n6. Includes error handling for missing config or failed connectivity\n7. Follows FQCN convention for all modules\n8. Includes copyright header\n9. Passes ansible-lint validation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-27T15:16:47.50886084-08:00","updated_at":"2026-01-27T15:39:16.463783725-08:00","closed_at":"2026-01-27T15:39:16.463783725-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["api","firewall","syncthing"]}
{"id":"fleet-35h","title":"Expand test coverage to all roles","description":"Currently 'mise run test' only runs the base role tests. Update the task or create new ones to run tests for all roles (sdr, meshtastic, printing_3d, etc.) to ensure complete coverage.","status":"deferred","priority":2,"issue_type":"task","created_at":"2026-01-06T16:11:36.140133708-08:00","created_by":"kayos","updated_at":"2026-01-06T16:22:41.077651275-08:00"}
{"id":"fleet-3ck","title":"Create Darwin firewall integration test","description":"## Context\nThis subtask is part of fleet-11m (Create integration test for Syncthing firewall configuration). It focuses on testing Darwin/macOS-specific firewall functionality.\n\n## Objective\nCreate an Ansible test playbook that verifies application firewall rules are properly configured and Syncthing ports are accessible on Darwin systems.\n\n## Test Coverage\n1. **Firewall Status**: Verify application firewall allows Syncthing\n2. **Port Listening**: Verify Syncthing is listening on required ports\n3. **API Access**: Test REST API connectivity (localhost)\n4. **Accessibility**: Verify ports are not blocked by application firewall\n\n## Implementation Location\n`roles/syncthing/tests/test_darwin_firewall.yml`\n\n## Acceptance Criteria\n1. Test playbook created at specified location\n2. Uses appropriate Darwin commands to check firewall status\n3. Uses `ansible.builtin.wait_for` to check port 22000 TCP listening\n4. Uses `ansible.builtin.wait_for` to check port 21027 UDP listening\n5. Tests API connectivity via /rest/system/ping\n6. Includes check mode compatibility (--check)\n7. Uses `ansible.builtin.assert` for all validations\n8. Provides clear failure messages\n9. Follows FQCN convention\n10. Includes copyright header\n11. Passes ansible-lint validation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-27T15:17:10.415664603-08:00","updated_at":"2026-01-27T15:39:17.259865943-08:00","closed_at":"2026-01-27T15:39:17.259865943-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["darwin","firewall","syncthing","testing"]}
{"id":"fleet-3m1","title":"Validate syncthing role with dry-run and linting","description":"Run comprehensive validation of the syncthing role implementation through dry-run testing and linting.\n\nThis ensures the role follows all project conventions and will execute correctly on target hosts.\n\n## Acceptance Criteria\n\n- [ ] `mise run dry-run-local` completes successfully with syncthing role\n- [ ] No ansible-lint errors specific to syncthing role\n- [ ] No markdownlint errors in syncthing README.md\n- [ ] `mise run lint` passes\n- [ ] `mise run test` passes\n- [ ] Role test playbook (roles/syncthing/tests/test.yml) passes in check mode","acceptance_criteria":"- [ ] `mise run dry-run-local` completes successfully with syncthing role\n- [ ] No ansible-lint errors specific to syncthing role\n- [ ] No markdownlint errors in syncthing README.md\n- [ ] `mise run lint` passes\n- [ ] `mise run test` passes\n- [ ] Role test playbook (roles/syncthing/tests/test.yml) passes in check mode","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T13:57:29.447135775-08:00","updated_at":"2026-01-27T13:58:22.921733952-08:00","dependencies":[{"issue_id":"fleet-3m1","depends_on_id":"fleet-n9m","type":"blocks","created_at":"2026-01-27T13:57:40.919434758-08:00","created_by":"daemon"},{"issue_id":"fleet-3m1","depends_on_id":"fleet-byo","type":"blocks","created_at":"2026-01-27T13:57:40.941228846-08:00","created_by":"daemon"},{"issue_id":"fleet-3m1","depends_on_id":"fleet-720","type":"blocks","created_at":"2026-01-27T13:57:40.979043728-08:00","created_by":"daemon"},{"issue_id":"fleet-3m1","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T13:57:49.761267805-08:00","created_by":"daemon"}]}
{"id":"fleet-4g6","title":"Create syncthing role for file synchronization","description":"Create a new Ansible role to install and configure Syncthing and Syncthing-GTK/Syncthingtray on laptops and workstations. Syncthing provides continuous file synchronization across devices.\n\n**Scope:**\n- Install syncthing daemon and syncthingtray GUI on Linux systems\n- Support both apt-based (Debian/Ubuntu) and homebrew-based (Darwin) installations\n- Enable and start syncthing service for the user\n- Add role to laptop and workstation groups\n\n**Out of Scope:**\n- Syncthing folder configuration (handled by user via GUI)\n- Device pairing (handled by user)\n- Firewall rules (syncthing uses dynamic ports via UPnP)\n\n## Success Criteria\n\n- [ ] Role directory structure created following project conventions\n- [ ] Platform-specific package installation implemented (Linux, Darwin)\n- [ ] Syncthing service enabled and started for user\n- [ ] Role added to all laptop and workstation hosts\n- [ ] Test playbook passes in check mode\n- [ ] `mise run lint` passes\n- [ ] `mise run test` passes\n- [ ] README.md documents role purpose and usage","acceptance_criteria":"- [ ] Role directory structure created following project conventions\n- [ ] Platform-specific package installation implemented (Linux, Darwin)\n- [ ] Syncthing service enabled and started for user\n- [ ] Role added to all laptop and workstation hosts\n- [ ] Test playbook passes in check mode\n- [ ] `mise run lint` passes\n- [ ] `mise run test` passes\n- [ ] README.md documents role purpose and usage","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-27T13:56:24.432557047-08:00","updated_at":"2026-01-27T13:58:27.422610415-08:00"}
{"id":"fleet-4j8","title":"Implement Linux package installation for syncthing","description":"Create Linux-specific package installation task file for Syncthing. Use apt module with proper privilege escalation and FQCN conventions.\n\nFollow pattern from roles/base/tasks/linux_install_packages.yml\n\n## Acceptance Criteria\n\n- [ ] roles/syncthing/tasks/linux_install_packages.yml created\n- [ ] Uses ansible.builtin.apt with FQCN\n- [ ] Installs packages from syncthing_package_names variable\n- [ ] Includes proper task naming and copyright header\n- [ ] Handles package cache update if needed\n- [ ] Uses become: true for privilege escalation","acceptance_criteria":"- [ ] roles/syncthing/tasks/linux_install_packages.yml created\n- [ ] Uses ansible.builtin.apt with FQCN\n- [ ] Installs packages from syncthing_package_names variable\n- [ ] Includes proper task naming and copyright header\n- [ ] Handles package cache update if needed\n- [ ] Uses become: true for privilege escalation","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T13:56:42.660466732-08:00","updated_at":"2026-01-27T13:58:05.233914739-08:00","dependencies":[{"issue_id":"fleet-4j8","depends_on_id":"fleet-l98","type":"blocks","created_at":"2026-01-27T13:57:40.629482553-08:00","created_by":"daemon"},{"issue_id":"fleet-4j8","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T13:57:45.807057364-08:00","created_by":"daemon"}]}
{"id":"fleet-4up","title":"Create Linux firewall integration test","description":"## Context\nThis subtask is part of fleet-11m (Create integration test for Syncthing firewall configuration). It focuses on testing Linux/ufw-specific firewall functionality.\n\n## Objective\nCreate an Ansible test playbook that verifies ufw rules are properly configured and Syncthing ports are accessible on Linux systems.\n\n## Test Coverage\n1. **Rule Verification**: Check ufw rules exist for ports 22000 (TCP/UDP) and 21027 (UDP)\n2. **Port Listening**: Verify Syncthing is listening on required ports\n3. **API Access**: Test REST API connectivity (localhost)\n4. **External Access**: Test port accessibility from another host (if possible)\n\n## Implementation Location\n`roles/syncthing/tests/test_linux_firewall.yml`\n\n## Acceptance Criteria\n1. Test playbook created at specified location\n2. Uses `ansible.builtin.command` to run `ufw status` and verify rules\n3. Uses `ansible.builtin.wait_for` to check port 22000 TCP listening\n4. Uses `ansible.builtin.wait_for` to check port 21027 UDP listening  \n5. Tests API connectivity via /rest/system/ping\n6. Includes check mode compatibility (--check)\n7. Uses `ansible.builtin.assert` for all validations\n8. Provides clear failure messages\n9. Follows FQCN convention\n10. Includes copyright header\n11. Passes ansible-lint validation\n12. Can be run standalone: `ansible-playbook roles/syncthing/tests/test_linux_firewall.yml`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-27T15:17:07.594527589-08:00","updated_at":"2026-01-27T15:39:17.110150481-08:00","closed_at":"2026-01-27T15:39:17.110150481-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["firewall","linux","syncthing","testing"]}
{"id":"fleet-5y5","title":"Document firewall setup and port configuration","description":"## Context\nThis subtask is part of fleet-y3k (Document firewall configuration in Syncthing role README). It focuses on explaining firewall basics, required ports, and platform-specific setup.\n\n## Objective\nAdd comprehensive documentation section to Syncthing role README explaining firewall configuration requirements and setup procedures.\n\n## Content Sections\n1. **Firewall Overview**: Explain why firewall rules are needed for peer-to-peer Syncthing\n2. **Required Ports**: Document TCP 22000 (sync), UDP 22000 (QUIC), UDP 21027 (discovery)\n3. **Linux Setup**: Document ufw rules and verification commands\n4. **Darwin Setup**: Document application firewall rules\n5. **Verification**: How to check if ports are properly opened\n\n## Acceptance Criteria\n1. New \"## Firewall Configuration\" section added to `roles/syncthing/README.md`\n2. Explains purpose of firewall rules (direct connections vs relay)\n3. Documents all three required ports with protocols\n4. Includes Linux/ufw configuration examples with commands\n5. Includes Darwin/pf configuration examples\n6. Shows verification commands (nc, lsof, netstat)\n7. Links to connection type verification task\n8. Uses proper markdown formatting\n9. Passes markdownlint validation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-27T15:16:58.146334703-08:00","updated_at":"2026-01-27T15:39:16.794191276-08:00","closed_at":"2026-01-27T15:39:16.794191276-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["documentation","firewall","syncthing"]}
{"id":"fleet-60e","title":"Fix beads git hooks to work with mise","description":"The git hooks installed by bd fail because 'bd' is not in the PATH when invoked by git. Need to configure them to load mise or use absolute paths.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:26:09.47632272-08:00","created_by":"kayos","updated_at":"2026-01-06T15:29:57.503105623-08:00","closed_at":"2026-01-06T15:29:57.503105623-08:00","close_reason":"Closed"}
{"id":"fleet-67f","title":"Add peer connectivity testing task","description":"Create task to test direct connectivity between Syncthing peers after firewall configuration.\n\n## Implementation\n\nCreate `roles/syncthing/tasks/test_connectivity.yml`:\n\n```yaml\n# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\n---\n- name: \"Syncthing | Gather all Syncthing hosts\"\n  ansible.builtin.set_fact:\n    syncthing_peer_hosts: \"{{ groups['laptop'] + groups['workstation'] }}\"\n  run_once: true\n  delegate_to: localhost\n\n- name: \"Syncthing | Test TCP connectivity to peers (port 22000)\"\n  ansible.builtin.wait_for:\n    host: \"{{ hostvars[item].ansible_default_ipv4.address }}\"\n    port: 22000\n    timeout: 5\n    state: started\n  loop: \"{{ syncthing_peer_hosts }}\"\n  when:\n    - item != inventory_hostname\n    - hostvars[item].ansible_default_ipv4 is defined\n    - syncthing_test_connectivity | default(false)\n  register: peer_tcp_test\n  failed_when: false\n\n- name: \"Syncthing | Test UDP connectivity to peers (port 22000)\"\n  ansible.builtin.command: \u003e\n    nc -zu -w 2 {{ hostvars[item].ansible_default_ipv4.address }} 22000\n  loop: \"{{ syncthing_peer_hosts }}\"\n  when:\n    - item != inventory_hostname\n    - hostvars[item].ansible_default_ipv4 is defined\n    - syncthing_test_connectivity | default(false)\n    - ansible_facts.system == \"Linux\"\n  register: peer_udp_test\n  changed_when: false\n  failed_when: false\n\n- name: \"Syncthing | Report connectivity test results\"\n  ansible.builtin.debug:\n    msg: |\n      Connectivity tests completed:\n      TCP success: {{ peer_tcp_test.results | selectattr('failed', 'equalto', false) | list | length }}\n      TCP failed: {{ peer_tcp_test.results | selectattr('failed', 'equalto', true) | list | length }}\n  when: syncthing_test_connectivity | default(false)\n```\n\nIntegration in `roles/syncthing/tasks/main.yml`:\n```yaml\n- name: \"Test peer connectivity\"\n  ansible.builtin.include_tasks: test_connectivity.yml\n  when: syncthing_test_connectivity | default(false)\n  tags: ['test', 'connectivity']\n```\n\nAdd to `roles/syncthing/defaults/main.yml`:\n```yaml\nsyncthing_test_connectivity: false  # Disabled by default (requires all hosts available)\n```\n\n## Notes\n\n- Requires all peer hosts to be reachable and have Syncthing running\n- Uses ansible facts to discover peer IP addresses\n- TCP test uses wait_for module\n- UDP test uses netcat (nc) command\n- Test is opt-in via variable to avoid failures in partial deployments","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] Task file `roles/syncthing/tasks/test_connectivity.yml` created\n- [ ] Task uses ansible.builtin.wait_for to test TCP connectivity on port 22000\n- [ ] Task tests connectivity to all peers in laptop and workstation groups\n- [ ] Task excludes self from connectivity testing\n- [ ] Task reports successful and failed connection counts\n- [ ] Variable `syncthing_test_connectivity` added to defaults (default: false)\n- [ ] Task integrated into main.yml with conditional\n- [ ] Task handles missing ansible facts gracefully\n- [ ] Copyright header present\n- [ ] `ansible-lint` passes\n- [ ] `mise run lint` passes","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:46:30.10233111-08:00","updated_at":"2026-01-27T19:33:43.847080977-08:00","labels":["connectivity","networking","syncthing","testing"],"dependencies":[{"issue_id":"fleet-67f","depends_on_id":"fleet-ccd","type":"blocks","created_at":"2026-01-27T14:46:30.108122782-08:00","created_by":"daemon"},{"issue_id":"fleet-67f","depends_on_id":"fleet-ccd","type":"parent-child","created_at":"2026-01-27T14:49:02.984299051-08:00","created_by":"daemon"}]}
{"id":"fleet-69s","title":"Create 1Password vault item for Syncthing device IDs","description":"Create 1Password vault item to store Syncthing device IDs with structured fields for each host.\n\n## Implementation\n\n1. **Create vault item using op CLI**:\n   ```bash\n   op item create \\\n     --category \"Secure Note\" \\\n     --title \"Syncthing Fleet Device IDs\" \\\n     --vault \"ServiceAccountAccess\"\n   ```\n\n2. **Add device ID fields**:\n   ```bash\n   op item edit \"Syncthing Fleet Device IDs\" \\\n     rincewind[text]=\"DEVICE-ID-PLACEHOLDER\" \\\n     dresden[text]=\"DEVICE-ID-PLACEHOLDER\" \\\n     caliban[text]=\"DEVICE-ID-PLACEHOLDER\" \\\n     jareth[text]=\"DEVICE-ID-PLACEHOLDER\" \\\n     constantine[text]=\"DEVICE-ID-PLACEHOLDER\"\n   ```\n\n3. **Document access pattern** in role README:\n   ```bash\n   # Read single device ID\n   op read \"op://ServiceAccountAccess/Syncthing Fleet Device IDs/rincewind\"\n   \n   # Read all device IDs (JSON)\n   op item get \"Syncthing Fleet Device IDs\" --format json | jq -r '.fields[] | select(.label != \"notesPlain\") | \"\\\\(.label)=\\\\(.value)\"'\n   ```\n\n## Acceptance Criteria\n\n- 1Password item created in ServiceAccountAccess vault\n- Fields created for all 5 hosts (rincewind, dresden, caliban, jareth, constantine)\n- Access pattern documented in roles/syncthing/README.md\n- Verified: `op item get \"Syncthing Fleet Device IDs\"` returns item\n- Item structure allows easy Ansible integration via lookup plugin","acceptance_criteria":"- [ ] 1Password vault item created: `op://ServiceAccountAccess/Syncthing Fleet Device IDs`\n- [ ] Item type: `password` (supports multiple fields)\n- [ ] Fields planned for 5 hosts: rincewind, dresden, caliban, jareth, constantine\n- [ ] `op read \"op://ServiceAccountAccess/Syncthing Fleet Device IDs/rincewind\"` command structure verified\n- [ ] Item created via `op item create` or web UI\n- [ ] Access verified: can read and write to item using fleet service account\n- [ ] Item documented in project secrets documentation or AGENTS.md","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:28:04.865691163-08:00","updated_at":"2026-01-27T14:56:44.287198239-08:00","labels":["1password","secrets-management","syncthing"],"dependencies":[{"issue_id":"fleet-69s","depends_on_id":"fleet-2w0","type":"blocks","created_at":"2026-01-27T14:28:04.882143056-08:00","created_by":"daemon"},{"issue_id":"fleet-69s","depends_on_id":"fleet-2w0","type":"parent-child","created_at":"2026-01-27T14:51:31.182681199-08:00","created_by":"daemon"}]}
{"id":"fleet-720","title":"Add syncthing role to laptop and workstation host configs","description":"Add the syncthing role to the roles_to_run list for laptop and workstation hosts. This enables automatic deployment of Syncthing to these machine categories.\n\n**Hosts to update:**\n- Laptops: rincewind, dresden, caliban\n- Workstations: constantine, jareth\n\n**Note**: rincewind and constantine already have host_vars files. Dresden, caliban, and jareth will need host_vars files created with roles_to_run list including syncthing.\n\nDo NOT add to servers (minecraft).\n\n## Acceptance Criteria\n\n- [ ] syncthing role added to `host_vars/rincewind.yml` roles_to_run list (laptop - existing file)\n- [ ] syncthing role added to `host_vars/constantine.yml` roles_to_run list (workstation - existing file)\n- [ ] `host_vars/dresden.yml` created with roles_to_run list including syncthing (laptop - new file)\n- [ ] `host_vars/caliban.yml` created with roles_to_run list including syncthing (laptop - new file)\n- [ ] `host_vars/jareth.yml` created with roles_to_run list including syncthing (workstation - new file)\n- [ ] Changes follow existing YAML formatting and conventions\n- [ ] Verified syncthing role NOT added to server hosts","acceptance_criteria":"- [ ] syncthing role added to `host_vars/rincewind.yml` roles_to_run list (laptop - existing file)\n- [ ] syncthing role added to `host_vars/constantine.yml` roles_to_run list (workstation - existing file)\n- [ ] `host_vars/dresden.yml` created with roles_to_run list including syncthing (laptop - new file)\n- [ ] `host_vars/caliban.yml` created with roles_to_run list including syncthing (laptop - new file)\n- [ ] `host_vars/jareth.yml` created with roles_to_run list including syncthing (workstation - new file)\n- [ ] All files follow existing YAML formatting conventions\n- [ ] Verified syncthing role NOT added to server hosts (minecraft should not have syncthing)\n- [ ] Files use consistent structure matching existing host_vars files\n- [ ] `mise run dry-run-local` shows syncthing role would be applied","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T13:57:20.822198476-08:00","updated_at":"2026-01-27T14:57:16.519651484-08:00","dependencies":[{"issue_id":"fleet-720","depends_on_id":"fleet-hef","type":"blocks","created_at":"2026-01-27T13:57:40.890841574-08:00","created_by":"daemon"},{"issue_id":"fleet-720","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T13:57:49.276513398-08:00","created_by":"daemon"}]}
{"id":"fleet-75d","title":"Create config.xml template with device list and folders","description":"Create Jinja2 template for Syncthing config.xml that includes all fleet devices and shared folder definitions.\n\n## Implementation\n\nCreate `roles/syncthing/templates/config.xml.j2`:\n\n```xml\n\u003cconfiguration version=\"37\"\u003e\n    \u003cfolder id=\"documents\" label=\"Documents\" path=\"{{ ansible_env.HOME }}/Sync/Documents\" type=\"sendreceive\" rescanIntervalS=\"3600\" fsWatcherEnabled=\"true\" fsWatcherDelayS=\"10\"\u003e\n{% for host in groups['laptop'] + groups['workstation'] %}\n        \u003cdevice id=\"{{ hostvars[host].syncthing_device_id }}\" introducedBy=\"\"\u003e\u003c/device\u003e\n{% endfor %}\n    \u003c/folder\u003e\n    \n{% for host in groups['laptop'] + groups['workstation'] %}\n    \u003cdevice id=\"{{ hostvars[host].syncthing_device_id }}\" name=\"{{ host }}\" compression=\"metadata\" introducer=\"false\" skipIntroductionRemovals=\"false\" introducedBy=\"\"\u003e\n        \u003caddress\u003edynamic\u003c/address\u003e\n        \u003cautoAcceptFolders\u003efalse\u003c/autoAcceptFolders\u003e\n    \u003c/device\u003e\n{% endfor %}\n    \n    \u003cgui enabled=\"true\" tls=\"false\" debugging=\"false\"\u003e\n        \u003caddress\u003e127.0.0.1:8384\u003c/address\u003e\n        \u003capikey\u003e{{ syncthing_api_key | default(lookup('password', '/dev/null chars=ascii_letters,digits length=32')) }}\u003c/apikey\u003e\n        \u003ctheme\u003edefault\u003c/theme\u003e\n    \u003c/gui\u003e\n    \n    \u003coptions\u003e\n        \u003clistenAddress\u003edefault\u003c/listenAddress\u003e\n        \u003cglobalAnnounceEnabled\u003etrue\u003c/globalAnnounceEnabled\u003e\n        \u003clocalAnnounceEnabled\u003etrue\u003c/localAnnounceEnabled\u003e\n        \u003crelaysEnabled\u003etrue\u003c/relaysEnabled\u003e\n        \u003cnatEnabled\u003etrue\u003c/natEnabled\u003e\n        \u003curAccepted\u003e-1\u003c/urAccepted\u003e\n    \u003c/options\u003e\n\u003c/configuration\u003e\n```\n\nCreate `roles/syncthing/defaults/main.yml` additions:\n```yaml\nsyncthing_shared_folders:\n  - id: documents\n    label: Documents\n    path: \"{{ ansible_env.HOME }}/Sync/Documents\"\n    type: sendreceive\n```\n\n## Acceptance Criteria\n\n- Template file created in roles/syncthing/templates/\n- Template loops over all laptop and workstation hosts\n- Device IDs populated from hostvars (requires prior device ID collection)\n- Shared folders configurable via syncthing_shared_folders variable\n- API key generated or sourced from defaults\n- Template follows Syncthing XML schema version 37\n- autoAcceptFolders set to false (security best practice)\n- Template validated against working Syncthing config.xml","acceptance_criteria":"- [ ] config.xml.j2 template created in roles/syncthing/templates/\n- [ ] Template includes device loop using syncthing_fleet_devices variable\n- [ ] Template includes folder configuration using syncthing_shared_folders variable\n- [ ] Jinja2 syntax validated with ansible-playbook --syntax-check\n- [ ] defaults/main.yml updated with syncthing_shared_folders variable structure\n- [ ] defaults/main.yml includes inline documentation for variable usage\n- [ ] Template generates valid XML: xmllint --noout passes on rendered output\n- [ ] Template tested with sample data produces expected config structure\n- [ ] Copyright header present in template file","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:28:18.319055548-08:00","updated_at":"2026-01-27T15:05:24.895705322-08:00","labels":["configuration","syncthing","templating"],"dependencies":[{"issue_id":"fleet-75d","depends_on_id":"fleet-2w0","type":"blocks","created_at":"2026-01-27T14:28:18.324243176-08:00","created_by":"daemon"},{"issue_id":"fleet-75d","depends_on_id":"fleet-2w0","type":"parent-child","created_at":"2026-01-27T14:51:32.296177874-08:00","created_by":"daemon"}]}
{"id":"fleet-7bj","title":"setup Crush with integration with Todoist","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T16:18:51.270722573-08:00","created_by":"kayos","updated_at":"2026-01-06T17:29:48.845067834-08:00","closed_at":"2026-01-06T17:29:48.845067834-08:00","close_reason":"Closed"}
{"id":"fleet-7bj.1","title":"install todoist MCP","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T16:20:49.016059692-08:00","created_by":"kayos","updated_at":"2026-01-06T17:29:31.062729608-08:00","closed_at":"2026-01-06T17:29:31.062729608-08:00","close_reason":"Closed","dependencies":[{"issue_id":"fleet-7bj.1","depends_on_id":"fleet-7bj","type":"parent-child","created_at":"2026-01-06T16:20:49.019017215-08:00","created_by":"kayos"}]}
{"id":"fleet-7bj.2","title":"configure Crush to use the todoist MCP","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T16:21:03.492018615-08:00","created_by":"kayos","updated_at":"2026-01-06T17:29:31.050994894-08:00","closed_at":"2026-01-06T17:29:31.050994894-08:00","close_reason":"Closed","dependencies":[{"issue_id":"fleet-7bj.2","depends_on_id":"fleet-7bj","type":"parent-child","created_at":"2026-01-06T16:21:03.494815886-08:00","created_by":"kayos"}]}
{"id":"fleet-7d6","title":"Add Syncthing port listening validation task","description":"Create validation task to verify Syncthing is listening on expected ports after firewall configuration.\n\n## Implementation\n\nCreate `roles/syncthing/tasks/validate_ports.yml`:\n\n```yaml\n# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\n---\n- name: \"Syncthing | Wait for Syncthing service to start\"\n  ansible.builtin.wait_for:\n    host: \"127.0.0.1\"\n    port: 8384\n    timeout: 30\n    state: started\n  when: syncthing_validate_ports | default(true)\n\n- name: \"Syncthing | Check TCP sync port (22000) is listening\"\n  ansible.builtin.wait_for:\n    host: \"0.0.0.0\"\n    port: 22000\n    timeout: 10\n    state: started\n  when: syncthing_validate_ports | default(true)\n  register: tcp_check\n  failed_when: false\n\n- name: \"Syncthing | Check UDP sync port (22000) is listening (Linux)\"\n  ansible.builtin.command: ss -ulnp\n  register: udp_check_linux\n  changed_when: false\n  when:\n    - ansible_facts.system == \"Linux\"\n    - syncthing_validate_ports | default(true)\n  failed_when: \"'22000' not in udp_check_linux.stdout\"\n\n- name: \"Syncthing | Check UDP discovery port (21027) is listening (Linux)\"\n  ansible.builtin.command: ss -ulnp\n  register: udp_discovery_linux\n  changed_when: false\n  when:\n    - ansible_facts.system == \"Linux\"\n    - syncthing_validate_ports | default(true)\n  failed_when: \"'21027' not in udp_discovery_linux.stdout\"\n\n- name: \"Syncthing | Check UDP ports are listening (Darwin)\"\n  ansible.builtin.command: netstat -anv -p udp\n  register: udp_check_darwin\n  changed_when: false\n  when:\n    - ansible_facts.system == \"Darwin\"\n    - syncthing_validate_ports | default(true)\n  failed_when: \n    - \"'22000' not in udp_check_darwin.stdout\"\n    - \"'21027' not in udp_check_darwin.stdout\"\n\n- name: \"Syncthing | Report port validation results\"\n  ansible.builtin.debug:\n    msg: \"Syncthing ports validated: TCP 22000, UDP 22000, UDP 21027\"\n  when: syncthing_validate_ports | default(true)\n```\n\nIntegration in `roles/syncthing/tasks/main.yml`:\n```yaml\n- name: \"Validate Syncthing ports\"\n  ansible.builtin.include_tasks: validate_ports.yml\n  when: syncthing_validate_ports | default(true)\n  tags: ['validate']\n```\n\nAdd to `roles/syncthing/defaults/main.yml`:\n```yaml\nsyncthing_validate_ports: true\n```","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] Task file `roles/syncthing/tasks/validate_ports.yml` created\n- [ ] Task verifies Syncthing service started (port 8384 listening)\n- [ ] Task verifies TCP 22000 is listening\n- [ ] Task verifies UDP 22000 is listening (platform-specific commands)\n- [ ] Task verifies UDP 21027 is listening (platform-specific commands)\n- [ ] Linux validation uses ss or netstat\n- [ ] Darwin validation uses netstat\n- [ ] Variable `syncthing_validate_ports` added to defaults (default: true)\n- [ ] Task integrated into main.yml with conditional\n- [ ] Copyright header present\n- [ ] `ansible-lint` passes\n- [ ] `mise run lint` passes","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:46:20.748947208-08:00","updated_at":"2026-01-27T19:33:46.034854221-08:00","labels":["syncthing","testing","validation"],"dependencies":[{"issue_id":"fleet-7d6","depends_on_id":"fleet-ccd","type":"blocks","created_at":"2026-01-27T14:46:20.754030999-08:00","created_by":"daemon"},{"issue_id":"fleet-7d6","depends_on_id":"fleet-ccd","type":"parent-child","created_at":"2026-01-27T14:49:02.434438743-08:00","created_by":"daemon"}]}
{"id":"fleet-9ia","title":"Create Syncthing API client helper task","description":"Create reusable Ansible task to authenticate with Syncthing REST API and prepare for API calls.\n\n## Context\nThis is part of connection type verification (parent: fleet-0mw). The API client will be used by verification logic to check connection types.\n\n## Implementation\n\nCreate `roles/syncthing/tasks/api_client_setup.yml`:\n\n- Read API key from config.xml using ansible.builtin.slurp or ansible.builtin.xml\n- Register API key as fact: syncthing_api_key\n- Construct API base URL: http://127.0.0.1:8384/rest\n- Test API connectivity with /rest/system/status endpoint\n- Fail gracefully if Syncthing not running\n\n## Acceptance Criteria\n\n- [ ] api_client_setup.yml created in roles/syncthing/tasks/\n- [ ] Task reads API key from syncthing_config_dir/config.xml\n- [ ] API key registered to fact: syncthing_api_key\n- [ ] API base URL constructed and registered to fact: syncthing_api_base_url\n- [ ] Connectivity test performs GET request to /rest/system/status\n- [ ] Task fails with clear message if Syncthing not running\n- [ ] Task fails with clear message if API key not found\n- [ ] Copyright header present\n- [ ] ansible-lint passes","status":"closed","priority":2,"issue_type":"task","owner":"kayos@genetikayos.com","created_at":"2026-01-27T15:13:20.658554197-08:00","created_by":"T.R. Fullhart","updated_at":"2026-01-27T15:39:22.191891923-08:00","closed_at":"2026-01-27T15:39:22.191891923-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["api","firewall","syncthing"],"dependencies":[{"issue_id":"fleet-9ia","depends_on_id":"fleet-err","type":"blocks","created_at":"2026-01-27T15:13:54.028852745-08:00","created_by":"daemon"}]}
{"id":"fleet-9xb","title":"Configure constantine host to use printing_3d role","description":"Create `host_vars/constantine.yml` and add `printing_3d` to the `roles_to_run` list.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:58.111218781-08:00","created_by":"kayos","updated_at":"2026-01-07T17:02:53.099129963-08:00","closed_at":"2026-01-07T17:02:53.099129963-08:00","close_reason":"Verified roles_to_run configuration is correct in host_vars/constantine.yml. Completed missing role dependencies (blender) in separate task."}
{"id":"fleet-ahg","title":"Configure Crush to use Ansible LSP","description":"Apply the LSP configuration for @ansible/ansible-language-server to Crush.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T16:01:25.770820306-08:00","created_by":"kayos","updated_at":"2026-01-06T16:01:57.53656302-08:00","closed_at":"2026-01-06T16:01:57.536574395-08:00"}
{"id":"fleet-ake","title":"Deploy auto-pairing to full fleet and validate","description":"Roll out auto-pairing configuration to all remaining hosts and validate fleet-wide connectivity.\n\n## Rollout Plan\n\n1. **Full Fleet Collection**:\n   ```bash\n   mise run syncthing:autopair --tags collect,store\n   ```\n\n2. **Full Fleet Configuration**:\n   ```bash\n   mise run syncthing:autopair --tags configure\n   ```\n\n3. **Validation Matrix** (verify all connections):\n   - rincewind  dresden, caliban, jareth, constantine\n   - dresden  rincewind, caliban, jareth, constantine\n   - caliban  rincewind, dresden, jareth, constantine\n   - jareth  rincewind, dresden, caliban, constantine\n   - constantine  rincewind, dresden, caliban, jareth\n\n4. **Connection Health Check**:\n   ```bash\n   # On each host, verify all 4 other devices connected\n   curl -s -H \"X-API-Key: $(grep apikey ~/.config/syncthing/config.xml | sed 's/.*\u003capikey\u003e\\\\(.*\\\\)\u003c\\\\/apikey\u003e.*/\\\\1/')\" \\\n     http://localhost:8384/rest/system/connections | jq -r '.connections | keys[]'\n   ```\n\n## Acceptance Criteria\n\n- All 5 hosts have device IDs in 1Password vault\n- All 5 hosts have templated config.xml applied\n- Each host shows 4 connected remote devices in web GUI\n- Connection health check returns 4 device IDs per host\n- No connection errors in Syncthing logs\n- Playbook execution time reasonable (\u003c 5 minutes for full fleet)\n- All hosts pass final validation\n- Documentation updated with any lessons learned during rollout","acceptance_criteria":"- [ ] Full fleet deployment completed: all 5 hosts (rincewind, dresden, caliban, jareth, constantine)\n- [ ] `mise run syncthing:autopair` executed successfully on all hosts\n- [ ] All Syncthing services running and active\n- [ ] Syncthing web GUI accessible on all hosts\n- [ ] Peer connectivity matrix validated: each host shows 4 connected devices\n- [ ] Connection verification for all 10 peer combinations (5 hosts  4 peers / 2)\n- [ ] Device IDs match between peers (both sides see same ID)\n- [ ] Shared folders configured and syncing\n- [ ] Idempotency test: second playbook run shows no changes\n- [ ] No relay connections: all connections show as \"direct\" via API check\n- [ ] Documentation complete and accurate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:29:02.643371471-08:00","updated_at":"2026-01-27T14:57:04.031715332-08:00","labels":["deployment","syncthing","validation"],"dependencies":[{"issue_id":"fleet-ake","depends_on_id":"fleet-2w0","type":"blocks","created_at":"2026-01-27T14:29:02.64876531-08:00","created_by":"daemon"},{"issue_id":"fleet-ake","depends_on_id":"fleet-00d","type":"blocks","created_at":"2026-01-27T14:29:12.554289537-08:00","created_by":"daemon"},{"issue_id":"fleet-ake","depends_on_id":"fleet-2w0","type":"parent-child","created_at":"2026-01-27T14:51:35.732526086-08:00","created_by":"daemon"}]}
{"id":"fleet-bdb","title":"Update AGENTS.md with next steps rule","description":"Add a rule to AGENTS.md instructing agents to always capture identified next steps as new tasks in the beads system.","status":"closed","priority":2,"issue_type":"task","assignee":"kayos","created_at":"2026-01-06T16:13:00.878858978-08:00","created_by":"kayos","updated_at":"2026-01-06T16:13:08.431961489-08:00","closed_at":"2026-01-06T16:13:08.431961489-08:00","close_reason":"Updated AGENTS.md with next steps rule"}
{"id":"fleet-byo","title":"Document syncthing role in README.md","description":"Create comprehensive README documentation for the syncthing role explaining its purpose, usage, supported platforms, and configuration details.\n\nReference other role READMEs for structure and content.\n\n## Acceptance Criteria\n\n- [ ] `roles/syncthing/README.md` created\n- [ ] Documents role purpose (file synchronization)\n- [ ] Lists supported platforms (Linux, Darwin)\n- [ ] Documents required variables (if any)\n- [ ] Provides usage examples showing how to add role to host_vars\n- [ ] Documents installed packages per platform\n- [ ] Notes about user service vs system service for syncthing daemon\n- [ ] Follows markdown conventions (passes markdownlint)","acceptance_criteria":"- [ ] `roles/syncthing/README.md` created\n- [ ] Documents role purpose (file synchronization)\n- [ ] Lists supported platforms (Linux, Darwin)\n- [ ] Documents required variables (if any)\n- [ ] Provides usage examples showing how to add role to host_vars\n- [ ] Documents installed packages per platform\n- [ ] Notes about user service vs system service for syncthing daemon\n- [ ] Follows markdown conventions (passes markdownlint)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T13:57:14.079956357-08:00","updated_at":"2026-01-27T14:06:33.032229961-08:00","dependencies":[{"issue_id":"fleet-byo","depends_on_id":"fleet-hef","type":"blocks","created_at":"2026-01-27T13:57:40.855006832-08:00","created_by":"daemon"},{"issue_id":"fleet-byo","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T13:57:48.721680272-08:00","created_by":"daemon"}]}
{"id":"fleet-c3u","title":"Create handlers for Syncthing service restart","description":"Create Ansible handlers to restart Syncthing services on Linux and Darwin after config changes.\n\n## Implementation\n\nUpdate `roles/syncthing/handlers/main.yml`:\n\n```yaml\n# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\n---\n- name: restart syncthing\n  ansible.builtin.systemd_service:\n    name: \"syncthing@{{ user_name }}.service\"\n    state: restarted\n    scope: user\n  when: ansible_facts.system | lower == 'linux'\n  listen: restart syncthing\n\n- name: restart syncthing\n  ansible.builtin.command:\n    cmd: launchctl kickstart -k \"gui/{{ ansible_user_uid }}/syncthing\"\n  when: ansible_facts.system | lower == 'darwin'\n  changed_when: true\n  listen: restart syncthing\n```\n\nAlternative Darwin approach using community.general.launchd:\n```yaml\n- name: restart syncthing\n  community.general.launchd:\n    name: syncthing\n    state: restarted\n  when: ansible_facts.system | lower == 'darwin'\n  listen: restart syncthing\n```\n\n## Acceptance Criteria\n\n- Handler created in roles/syncthing/handlers/main.yml\n- Linux handler restarts syncthing@username.service with user scope\n- Darwin handler restarts Syncthing via launchctl\n- Handler uses listen directive for unified notification\n- Handler only executes when notified by config change tasks\n- Handler respects platform differences (ansible_facts.system)\n- Follows FQCN convention and copyright header\n- `ansible-lint` passes","acceptance_criteria":"- [ ] Handler file created: `roles/syncthing/handlers/main.yml`\n- [ ] Linux handler: restart `syncthing@{{ user_name }}.service` using systemd\n- [ ] Darwin handler: restart Syncthing using `launchctl` or homebrew services\n- [ ] Handlers use platform-specific task includes: `{{ ansible_facts.system | lower }}_restart_syncthing.yml`\n- [ ] Handler names: \"restart syncthing\" (generic), \"restart syncthing linux\", \"restart syncthing darwin\"\n- [ ] Copyright header present in handler file\n- [ ] Test notification: add `notify: restart syncthing` to dummy task, verify service restarts\n- [ ] Handler waits for service to be running before completing\n- [ ] ansible-lint passes on handler file","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:28:35.212352182-08:00","updated_at":"2026-01-27T14:56:57.113993458-08:00","labels":["service-management","syncthing"],"dependencies":[{"issue_id":"fleet-c3u","depends_on_id":"fleet-2w0","type":"blocks","created_at":"2026-01-27T14:28:35.217107557-08:00","created_by":"daemon"},{"issue_id":"fleet-c3u","depends_on_id":"fleet-75d","type":"blocks","created_at":"2026-01-27T14:29:07.899963943-08:00","created_by":"daemon"},{"issue_id":"fleet-c3u","depends_on_id":"fleet-loh","type":"blocks","created_at":"2026-01-27T14:29:08.34655091-08:00","created_by":"daemon"},{"issue_id":"fleet-c3u","depends_on_id":"fleet-2w0","type":"parent-child","created_at":"2026-01-27T14:51:33.735197597-08:00","created_by":"daemon"}]}
{"id":"fleet-c8a","title":"Create syncthing role directory structure only","description":"Create the basic directory structure for the syncthing role. This creates empty directories following project conventions.\n\nReference: AGENTS.md section \"Adding a New Role\"\n\n## Acceptance Criteria\n\n- [ ] Directory structure created: `roles/syncthing/{tasks,defaults,vars,handlers,meta,tests,files,templates}/`\n- [ ] All directories are empty (files will be added in subsequent tasks)","acceptance_criteria":"- [ ] Directory structure created: `roles/syncthing/{tasks,defaults,vars,handlers,meta,tests,files,templates}/`\n- [ ] All directories are empty (files will be added in subsequent tasks)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-27T13:56:30.016476241-08:00","updated_at":"2026-01-27T19:28:14.794942627-08:00","closed_at":"2026-01-27T19:28:14.794942627-08:00","close_reason":"Closed","dependencies":[{"issue_id":"fleet-c8a","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T13:57:40.547324654-08:00","created_by":"daemon"}]}
{"id":"fleet-ccd","title":"Configure firewall rules for optimal Syncthing peer connectivity","description":"Ensure firewalls on all fleet hosts allow Syncthing traffic for direct peer-to-peer connections, reducing reliance on relay servers and improving sync performance.\n\n## Background\n\nSyncthing uses multiple connection methods with fallback priorities:\n1. **Direct TCP (port 22000)** - Fastest, lowest latency\n2. **Direct QUIC (port 22000/UDP)** - Fast with better NAT traversal\n3. **Local Discovery (port 21027/UDP)** - LAN device discovery\n4. **Global Discovery** - Internet-based discovery via discovery servers\n5. **Relay Servers** - Fallback when direct connections fail (slowest)\n\nWithout proper firewall rules, Syncthing falls back to relay servers which adds latency and reduces throughput. This epic ensures direct connections work optimally.\n\n## Scope\n\n**In Scope:**\n- Configure ufw (Linux) to allow Syncthing ports\n- Configure pf/application firewall (Darwin) to allow Syncthing\n- Support both IPv4 and IPv6\n- Document firewall configuration in role README\n- Validate firewall rules applied correctly\n- Test connectivity between peers after firewall configuration\n\n**Out of Scope:**\n- Router/gateway firewall configuration (manual, environment-specific)\n- Port forwarding configuration (UPnP handles this automatically)\n- VPN/ZeroTier firewall rules (handled by those services)\n- Custom Syncthing port configuration (uses defaults)\n\n## Technical Approach\n\n### Linux (ufw)\n```yaml\n- name: Allow Syncthing sync traffic\n  community.general.ufw:\n    rule: allow\n    port: '22000'\n    proto: any\n    comment: 'Syncthing sync protocol'\n\n- name: Allow Syncthing local discovery\n  community.general.ufw:\n    rule: allow\n    port: '21027'\n    proto: udp\n    comment: 'Syncthing local discovery'\n```\n\n### Darwin (pf)\n```yaml\n- name: Configure pf to allow Syncthing\n  ansible.builtin.blockinfile:\n    path: /etc/pf.anchors/syncthing\n    create: true\n    block: |\n      pass in proto tcp from any to any port 22000\n      pass in proto udp from any to any port { 22000, 21027 }\n```\n\n### Validation\n```bash\n# Test port listening\nss -tlnp | grep 22000  # Linux\nnetstat -an | grep 22000  # Darwin\n\n# Test connectivity from remote host\nnc -zv \u003cremote_ip\u003e 22000\n```\n\n## Dependencies\n\n- **Prerequisite**: fleet-4g6 (Syncthing installation)\n- **Prerequisite**: fleet-2w0 (auto-pairing configuration)\n- **Recommended**: Syncthing running on all hosts before testing","acceptance_criteria":"-","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-27T14:45:02.896178085-08:00","updated_at":"2026-01-27T15:45:16.252644983-08:00","labels":["firewall","networking","security","syncthing"],"dependencies":[{"issue_id":"fleet-ccd","depends_on_id":"fleet-4g6","type":"blocks","created_at":"2026-01-27T14:45:02.902877724-08:00","created_by":"daemon"},{"issue_id":"fleet-ccd","depends_on_id":"fleet-2w0","type":"blocks","created_at":"2026-01-27T14:45:02.908690105-08:00","created_by":"daemon"}]}
{"id":"fleet-cg6","title":"discover if there is an MCP for the Todoist service","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T16:16:32.860415129-08:00","created_by":"kayos","updated_at":"2026-01-06T17:29:48.851344464-08:00","closed_at":"2026-01-06T17:29:48.851344464-08:00","close_reason":"Closed","dependencies":[{"issue_id":"fleet-cg6","depends_on_id":"fleet-7bj","type":"blocks","created_at":"2026-01-06T16:19:21.756025017-08:00","created_by":"kayos"}]}
{"id":"fleet-cnb","title":"Configure Crush to use GitHub MCP","description":"Set up GitHub Model Context Protocol server for Crush to enable repository interaction and issue management.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:48:45.239818816-08:00","created_by":"kayos","updated_at":"2026-01-06T15:53:47.531460257-08:00","closed_at":"2026-01-06T15:53:47.531469299-08:00"}
{"id":"fleet-d6a","title":"Document connection types and troubleshooting","description":"## Context\nThis subtask is part of fleet-y3k (Document firewall configuration in Syncthing role README). It assumes readers understand firewall basics (from setup docs) and focuses on diagnosing connection issues.\n\n## Objective\nAdd troubleshooting documentation to help users diagnose and fix connection type issues, particularly when peers fall back to relay connections.\n\n## Content Sections\n1. **Connection Types**: Explain direct-*, quic-*, relay-* connection types\n2. **Identifying Issues**: How to check current connection types (Web UI, API, CLI)\n3. **Common Problems**: Firewall misconfiguration, NAT issues, discovery problems\n4. **Debugging Steps**: Systematic approach to diagnose connection failures\n5. **Solutions**: How to fix each common problem\n\n## Acceptance Criteria\n1. New \"## Troubleshooting Connections\" section added to `roles/syncthing/README.md`\n2. Explains difference between direct/QUIC/relay connection types\n3. Shows how to check connection types via Web UI\n4. Shows how to check via REST API (/rest/system/connections)\n5. Documents common failure patterns (all-relay, partial-relay, no-connection)\n6. Provides debugging checklist (firewall, ports, discovery, NAT)\n7. Links to verification task documentation\n8. Includes example outputs and interpretations\n9. Uses proper markdown formatting\n10. Passes markdownlint validation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-27T15:17:03.04032486-08:00","updated_at":"2026-01-27T15:39:16.962155077-08:00","closed_at":"2026-01-27T15:39:16.962155077-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["documentation","firewall","syncthing"],"dependencies":[{"issue_id":"fleet-d6a","depends_on_id":"fleet-5y5","type":"blocks","created_at":"2026-01-27T15:17:25.99080649-08:00","created_by":"daemon"}]}
{"id":"fleet-dms","title":"Install and setup Ansible Language Server","description":"Add @ansible/ansible-language-server to mise.toml tools to enable LSP support for Crush.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:43:57.240889327-08:00","created_by":"kayos","updated_at":"2026-01-06T15:44:24.026557285-08:00","closed_at":"2026-01-06T15:44:24.026563702-08:00"}
{"id":"fleet-dzd","title":"Create syncthing role foundation files","description":"Create the minimal foundation files for the syncthing role with copyright headers and placeholders. These files will be populated in subsequent tasks.\n\nFiles to create:\n- `roles/syncthing/tasks/main.yml` - Empty with copyright header\n- `roles/syncthing/defaults/main.yml` - Empty with copyright header and comment placeholder\n- `roles/syncthing/handlers/main.yml` - Empty with copyright header\n\n## Acceptance Criteria\n\n- [ ] `roles/syncthing/tasks/main.yml` created with copyright header \"# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\"\n- [ ] `roles/syncthing/defaults/main.yml` created with copyright header and comment \"# Default variables for syncthing role\"\n- [ ] `roles/syncthing/handlers/main.yml` created with copyright header\n- [ ] All files follow project formatting conventions","acceptance_criteria":"- [ ] `roles/syncthing/tasks/main.yml` created with copyright header \"# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\"\n- [ ] `roles/syncthing/defaults/main.yml` created with copyright header and comment \"# Default variables for syncthing role\"\n- [ ] `roles/syncthing/handlers/main.yml` created with copyright header\n- [ ] All files follow project formatting conventions","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:06:09.385519938-08:00","updated_at":"2026-01-27T14:06:09.385519938-08:00","labels":["syncthing"],"dependencies":[{"issue_id":"fleet-dzd","depends_on_id":"fleet-c8a","type":"blocks","created_at":"2026-01-27T14:06:16.476245585-08:00","created_by":"daemon"},{"issue_id":"fleet-dzd","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T14:06:16.600986556-08:00","created_by":"daemon"}]}
{"id":"fleet-ecb","title":"Implement prusa-slicer installation in printing_3d role","description":"Found TODO in roles/printing_3d/tasks/main.yml: install prusa-slicer","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:36:45.150031629-08:00","created_by":"kayos","updated_at":"2026-01-07T16:41:11.596793591-08:00","closed_at":"2026-01-07T16:41:11.596793591-08:00","close_reason":"Implemented prusa-slicer installation in printing_3d role"}
{"id":"fleet-err","title":"Implement connection type verification via API","description":"Query Syncthing connections API and verify all peers using direct connections (not relay).\n\n## Context\nThis is part of connection type verification (parent: fleet-0mw). Uses API client setup from sibling task.\n\n## Implementation\n\nCreate `roles/syncthing/tasks/verify_connection_type.yml`:\n\n- Include api_client_setup.yml task\n- Query /rest/system/connections endpoint with API key\n- Parse JSON response for each peer connection\n- Extract connection.type field for each peer\n- Verify all connections show type==\"direct\" or type==\"quic\"\n- Warn if any connection shows type==\"relay\"\n- Register verification result as fact\n\n## Acceptance Criteria\n\n- [ ] verify_connection_type.yml created in roles/syncthing/tasks/\n- [ ] Task includes api_client_setup.yml\n- [ ] Task queries /rest/system/connections with X-API-Key header\n- [ ] JSON response parsed using from_json filter\n- [ ] Connection type extracted for each peer: .connections[].type\n- [ ] Task warns (not fails) if relay connections detected\n- [ ] Task fails if API returns error or invalid JSON\n- [ ] Verification result registered to fact: syncthing_connections_verified\n- [ ] Task documents expected connection types in comments\n- [ ] Copyright header present\n- [ ] ansible-lint passes","status":"closed","priority":2,"issue_type":"task","owner":"kayos@genetikayos.com","created_at":"2026-01-27T15:13:25.702166354-08:00","created_by":"T.R. Fullhart","updated_at":"2026-01-27T15:39:15.520068856-08:00","closed_at":"2026-01-27T15:39:15.520068856-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["api","firewall","syncthing"]}
{"id":"fleet-gci","title":"configure Crush to use the GitHub MCP","notes":"Configured GitHub MCP in .crush.json with authentication via 1Password CLI. The MCP server provides access to GitHub API operations including file management, repository operations, PR/issue management, and search functionality.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T16:15:26.383202543-08:00","created_by":"kayos","updated_at":"2026-01-06T16:35:11.359518776-08:00","closed_at":"2026-01-06T16:35:11.359530443-08:00"}
{"id":"fleet-gfi","title":"Implement Darwin package installation for syncthing","description":"Create Darwin-specific package installation task file for Syncthing. Use homebrew module with proper FQCN conventions.\n\nFollow pattern from roles/base/tasks/darwin_install_packages.yml\n\n## Acceptance Criteria\n\n- [ ] roles/syncthing/tasks/darwin_install_packages.yml created\n- [ ] Uses community.general.homebrew with FQCN\n- [ ] Installs packages from syncthing_package_names variable\n- [ ] Includes proper task naming and copyright header\n- [ ] Uses state: present for package installation","acceptance_criteria":"- [ ] roles/syncthing/tasks/darwin_install_packages.yml created\n- [ ] Uses community.general.homebrew with FQCN\n- [ ] Installs packages from syncthing_package_names variable\n- [ ] Includes proper task naming and copyright header\n- [ ] Uses state: present for package installation","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T13:56:46.699748974-08:00","updated_at":"2026-01-27T13:58:05.258193264-08:00","dependencies":[{"issue_id":"fleet-gfi","depends_on_id":"fleet-l98","type":"blocks","created_at":"2026-01-27T13:57:40.664092868-08:00","created_by":"daemon"},{"issue_id":"fleet-gfi","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T13:57:46.341143494-08:00","created_by":"daemon"}]}
{"id":"fleet-hef","title":"Implement main.yml orchestration for syncthing role","description":"Implement the main task orchestration file (roles/syncthing/tasks/main.yml) that ties together variable loading, package installation, and service management.\n\nFollow the pattern from roles/base/tasks/main.yml:\n1. Load OS-specific variables\n2. Include platform-specific package installation\n3. Include platform-specific service enablement\n\n## Acceptance Criteria\n\n- [ ] roles/syncthing/tasks/main.yml implements OS-specific variable loading\n- [ ] Includes platform-specific package installation (linux_install_packages.yml, darwin_install_packages.yml)\n- [ ] Includes platform-specific service enablement (linux_enable_service.yml, darwin_enable_service.yml)\n- [ ] Uses ansible_facts.system to dynamically include correct task files\n- [ ] Follows base role pattern for structure and naming\n- [ ] All tasks use FQCN and proper naming conventions\n- [ ] Copyright header present","acceptance_criteria":"- [ ] roles/syncthing/tasks/main.yml implements OS-specific variable loading\n- [ ] Includes platform-specific package installation (linux_install_packages.yml, darwin_install_packages.yml)\n- [ ] Includes platform-specific service enablement (linux_enable_service.yml, darwin_enable_service.yml)\n- [ ] Uses ansible_facts.system to dynamically include correct task files\n- [ ] Follows base role pattern for structure and naming\n- [ ] All tasks use FQCN and proper naming conventions\n- [ ] Copyright header present","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T13:57:03.257942237-08:00","updated_at":"2026-01-27T13:58:12.559162696-08:00","dependencies":[{"issue_id":"fleet-hef","depends_on_id":"fleet-mtd","type":"blocks","created_at":"2026-01-27T13:57:40.760298127-08:00","created_by":"daemon"},{"issue_id":"fleet-hef","depends_on_id":"fleet-k81","type":"blocks","created_at":"2026-01-27T13:57:40.780462661-08:00","created_by":"daemon"},{"issue_id":"fleet-hef","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T13:57:47.739560859-08:00","created_by":"daemon"}]}
{"id":"fleet-hvh","title":"Fix UFW OpenSSH profile error in base role tests on Arch Linux","description":"The `mise run test` command fails on `roles/base/tasks/linux_enable_sshd.yml` with `ERROR: Could not find a profile matching 'OpenSSH'`. This requires investigating why the OpenSSH profile is missing on the Arch Linux environment or adjusting the variable `base_ufw_ssh_app_profile_name` in `roles/base/vars/archlinux.yml`.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:25:59.606789789-08:00","created_by":"kayos","updated_at":"2026-01-07T16:28:22.980249816-08:00","closed_at":"2026-01-07T16:28:22.980249816-08:00","close_reason":"Fixed UFW profile name for Arch Linux to use 'SSH'"}
{"id":"fleet-i81","title":"Configure Crush to use Ansible Language Server","description":"Verify and ensure Crush configuration is set up to utilize the installed Ansible Language Server.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:07.086137695-08:00","created_by":"kayos","updated_at":"2026-01-06T15:58:43.258343205-08:00","closed_at":"2026-01-06T15:58:43.25834933-08:00"}
{"id":"fleet-ic2","title":"Document auto-pairing feature in role README","description":"Document the Syncthing auto-pairing feature in role README and project documentation.\n\n## Implementation\n\nUpdate `roles/syncthing/README.md` with new section:\n\n```markdown\n## Auto-Pairing (Optional)\n\nThe role supports automatic device pairing across the fleet using 1Password for device ID storage.\n\n### Prerequisites\n\n1. Syncthing installed and running on all hosts (base role functionality)\n2. 1Password CLI authenticated: `op signin`\n3. Device IDs collected at least once: `mise run syncthing:autopair --tags collect,store`\n\n### Initial Setup\n\n1. **Collect device IDs**:\n   ```bash\n   mise run syncthing:autopair --tags collect,store\n   ```\n\n2. **Apply configuration**:\n   ```bash\n   mise run syncthing:autopair --tags configure\n   ```\n\n3. **Verify pairing**:\n   - Open Syncthing web GUI on any host: `http://localhost:8384`\n   - Navigate to \"Remote Devices\" - all fleet devices should be listed\n   - Check connection status (should show \"Connected\" after a few seconds)\n\n### Shared Folders\n\nDefine shared folders in `roles/syncthing/defaults/main.yml`:\n\n```yaml\nsyncthing_shared_folders:\n  - id: documents\n    label: Documents\n    path: \"{{ ansible_env.HOME }}/Sync/Documents\"\n    type: sendreceive\n  - id: photos\n    label: Photos\n    path: \"{{ ansible_env.HOME }}/Sync/Photos\"\n    type: sendreceive\n```\n\n### Adding New Hosts\n\nWhen adding new hosts to the fleet:\n\n1. Run base Syncthing installation on new host\n2. Collect device ID: `mise run syncthing:autopair --tags collect,store -l newhostname`\n3. Re-apply config to all hosts: `mise run syncthing:autopair --tags configure`\n\n### Troubleshooting\n\n- **Device not connecting**: Check firewall rules, ensure port 22000/TCP open\n- **Config validation fails**: Check XML syntax in template\n- **1Password lookup fails**: Verify `op signin` session active\n```\n\nUpdate project `README.md` with reference to Syncthing role.\n\n## Acceptance Criteria\n\n- roles/syncthing/README.md updated with auto-pairing section\n- Prerequisites documented clearly\n- Setup workflow documented step-by-step\n- Shared folder configuration explained with examples\n- Adding new hosts procedure documented\n- Troubleshooting section included\n- Project README.md references Syncthing role\n- `markdownlint` passes on all documentation","acceptance_criteria":"- [ ] `roles/syncthing/README.md` updated with auto-pairing feature section\n- [ ] Section includes overview of auto-pairing workflow (2-phase: collection/config)\n- [ ] Documents required 1Password setup: vault item path and structure\n- [ ] Documents mise task usage: `mise run syncthing:autopair`\n- [ ] Explains device ID collection from REST API\n- [ ] Explains config.xml templating with device list\n- [ ] Documents limitations: requires 1Password CLI (`op signin`)\n- [ ] Includes troubleshooting section for common issues\n- [ ] Includes example output or sample device ID format\n- [ ] markdownlint passes on README.md\n- [ ] Links to relevant task files for technical details","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:28:50.603227015-08:00","updated_at":"2026-01-27T14:57:00.528009122-08:00","labels":["documentation","syncthing"],"dependencies":[{"issue_id":"fleet-ic2","depends_on_id":"fleet-2w0","type":"blocks","created_at":"2026-01-27T14:28:50.60915665-08:00","created_by":"daemon"},{"issue_id":"fleet-ic2","depends_on_id":"fleet-2w0","type":"parent-child","created_at":"2026-01-27T14:51:34.753259582-08:00","created_by":"daemon"}]}
{"id":"fleet-in2","title":"Implement connection type verification via API","description":"## Context\nThis subtask is part of fleet-0mw (Add Syncthing connection type verification via API). It implements the business logic for querying connection types and verifying direct/QUIC connections.\n\n## Objective\nCreate an Ansible task that queries the Syncthing REST API to verify all peer connections are using direct (non-relay) connection types.\n\n## Implementation\nCreate verification task that:\n- Includes api_client_setup.yml for API access\n- Queries `/rest/system/connections` endpoint\n- Parses JSON response to extract connection types for each peer\n- Verifies all connections use \"direct-*\" or \"quic-*\" (not \"relay-*\")\n- Fails with clear error if relay connections detected\n\n## Acceptance Criteria\n1. Task file created that includes api_client_setup.yml\n2. Uses `ansible.builtin.uri` to query `/rest/system/connections`\n3. Parses JSON response with `ansible.builtin.set_fact` or `ansible.builtin.debug`\n4. Checks each peer's connection type field\n5. Accepts \"direct-accept\", \"direct-dial\", \"quic-accept\", \"quic-dial\" as valid\n6. Rejects \"relay-accept\", \"relay-dial\" as invalid (fails task)\n7. Provides clear error message listing which peers use relay\n8. Can be run as part of validation play or standalone\n9. Follows FQCN convention\n10. Includes copyright header\n11. Passes ansible-lint validation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-27T15:16:52.779985301-08:00","updated_at":"2026-01-27T15:39:16.628713873-08:00","closed_at":"2026-01-27T15:39:16.628713873-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["api","firewall","syncthing"],"dependencies":[{"issue_id":"fleet-in2","depends_on_id":"fleet-33f","type":"blocks","created_at":"2026-01-27T15:17:25.456684813-08:00","created_by":"daemon"}]}
{"id":"fleet-jj1","title":"Configure Darwin firewall rules for Syncthing ports","description":"Create Ansible task to configure macOS firewall rules for Syncthing on Darwin hosts.\n\n## Implementation\n\nCreate `roles/syncthing/tasks/darwin_configure_firewall.yml`:\n\n```yaml\n# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\n---\n- name: \"Syncthing | Check if application firewall is enabled\"\n  ansible.builtin.command: /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate\n  register: darwin_firewall_state\n  changed_when: false\n  become: true\n\n- name: \"Syncthing | Add Syncthing to application firewall\"\n  ansible.builtin.command: \u003e\n    /usr/libexec/ApplicationFirewall/socketfilterfw --add {{ syncthing_binary_path }}\n  become: true\n  when: \n    - \"'enabled' in darwin_firewall_state.stdout\"\n    - syncthing_binary_path is defined\n  register: fw_add\n  changed_when: \"'already exists' not in fw_add.stderr\"\n  failed_when: \n    - fw_add.rc != 0\n    - \"'already exists' not in fw_add.stderr\"\n\n- name: \"Syncthing | Allow incoming connections for Syncthing\"\n  ansible.builtin.command: \u003e\n    /usr/libexec/ApplicationFirewall/socketfilterfw --unblockapp {{ syncthing_binary_path }}\n  become: true\n  when: \n    - \"'enabled' in darwin_firewall_state.stdout\"\n    - syncthing_binary_path is defined\n  changed_when: false\n```\n\nIntegration in `roles/syncthing/tasks/main.yml`:\n```yaml\n- name: \"Include firewall configuration\"\n  ansible.builtin.include_tasks: \"{{ ansible_facts.system | lower }}_configure_firewall.yml\"\n  when: syncthing_configure_firewall | default(true)\n```\n\nAdd to `roles/syncthing/defaults/main.yml`:\n```yaml\nsyncthing_binary_path: \"/opt/homebrew/bin/syncthing\"  # Darwin default\n```\n\n## Notes\n\n- macOS application firewall works at application level, not port level\n- pf (packet filter) configuration requires more complex setup and kernel extension\n- socketfilterfw is the native macOS tool for application firewall\n- Alternative: Instruct user to allow Syncthing via System Preferences GUI","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] Task file `roles/syncthing/tasks/darwin_configure_firewall.yml` created\n- [ ] Task checks if application firewall is enabled using socketfilterfw\n- [ ] Task adds Syncthing binary to application firewall allowed apps\n- [ ] Task unblocks Syncthing app to allow incoming connections\n- [ ] Task includes idempotency checks (handles \"already exists\" errors)\n- [ ] Task runs with become: true (requires sudo)\n- [ ] Variable `syncthing_binary_path` added to defaults (/opt/homebrew/bin/syncthing)\n- [ ] Task only runs when firewall is enabled\n- [ ] Copyright header present\n- [ ] `ansible-lint` passes\n- [ ] `mise run lint` passes","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:46:12.514169237-08:00","updated_at":"2026-01-27T19:33:48.296231867-08:00","labels":["darwin","firewall","macos","syncthing"],"dependencies":[{"issue_id":"fleet-jj1","depends_on_id":"fleet-ccd","type":"blocks","created_at":"2026-01-27T14:46:12.519522531-08:00","created_by":"daemon"},{"issue_id":"fleet-jj1","depends_on_id":"fleet-ccd","type":"parent-child","created_at":"2026-01-27T14:49:01.998923198-08:00","created_by":"daemon"}]}
{"id":"fleet-k81","title":"Implement Darwin service enablement for syncthing","description":"Create Darwin-specific task file to enable and start Syncthing using launchd. Darwin uses launchd instead of systemd for service management.\n\nFollow pattern from roles/base/tasks/darwin_enable_*.yml files.\n\n## Acceptance Criteria\n\n- [ ] roles/syncthing/tasks/darwin_enable_service.yml created\n- [ ] Uses community.general.launchd with FQCN\n- [ ] Enables and starts syncthing service on Darwin\n- [ ] Includes proper task naming and copyright header\n- [ ] Uses state: started and enabled: true","acceptance_criteria":"- [ ] roles/syncthing/tasks/darwin_enable_service.yml created\n- [ ] Uses community.general.launchd with FQCN\n- [ ] Enables and starts syncthing service on Darwin\n- [ ] Includes proper task naming and copyright header\n- [ ] Uses state: started and enabled: true","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T13:56:57.434884623-08:00","updated_at":"2026-01-27T13:58:09.500636479-08:00","dependencies":[{"issue_id":"fleet-k81","depends_on_id":"fleet-gfi","type":"blocks","created_at":"2026-01-27T13:57:40.725495602-08:00","created_by":"daemon"},{"issue_id":"fleet-k81","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T13:57:47.239076744-08:00","created_by":"daemon"}]}
{"id":"fleet-l6e","title":"Create cross-platform firewall integration test","description":"Create integration test to verify firewall configuration works across Linux and Darwin platforms.\n\n## Context\nThis is part of firewall integration testing (parent: fleet-11m). Validates complete firewall configuration.\n\n## Implementation\n\nCreate `roles/syncthing/tests/test_firewall_integration.yml`:\n\n- Run on mixed platform group (laptop:workstation)\n- Verify platform-specific firewall tasks execute correctly\n- Test peer connectivity across platforms (Linux to Darwin, Darwin to Linux)\n- Use API to verify connection types (direct, not relay)\n- Verify all hosts can reach each other on port 22000\n- Test discovery on port 21027\n\n## Acceptance Criteria\n\n- [ ] test_firewall_integration.yml created in roles/syncthing/tests/\n- [ ] Test runs on laptop and workstation groups (mixed platforms)\n- [ ] Test includes platform-specific task execution\n- [ ] Test verifies peer connectivity across platforms\n- [ ] Test uses /rest/system/connections API to verify connection types\n- [ ] Test verifies all connections are direct (not relay)\n- [ ] Test includes cross-platform connectivity matrix validation\n- [ ] Test verifies discovery protocol on UDP 21027\n- [ ] Test handles failures gracefully with clear error messages\n- [ ] Copyright header present\n- [ ] ansible-playbook --syntax-check passes\n- [ ] ansible-lint passes","status":"closed","priority":2,"issue_type":"task","owner":"kayos@genetikayos.com","created_at":"2026-01-27T15:13:47.739986554-08:00","created_by":"T.R. Fullhart","updated_at":"2026-01-27T15:39:16.312348038-08:00","closed_at":"2026-01-27T15:39:16.312348038-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["firewall","integration","syncthing","testing"]}
{"id":"fleet-l98","title":"Define OS-specific package variables for syncthing","description":"Define OS-specific package variables for Syncthing installation following the project's layered variable pattern (system  os_family  distribution).\n\n**Packages to include:**\n- Linux/Debian: syncthing, syncthingtray (or syncthing-gtk if available)\n- Darwin: syncthing (homebrew), syncthing-macos or equivalent GUI\n\nFollow the variable loading pattern used in base role.\n\n## Acceptance Criteria\n\n- [ ] roles/syncthing/vars/linux.yml created with syncthing packages\n- [ ] roles/syncthing/vars/debian.yml created with apt-specific package names (syncthing, syncthingtray)\n- [ ] roles/syncthing/vars/darwin.yml created with homebrew package names (syncthing, syncthing-gtk or equivalent)\n- [ ] Variables follow naming convention: syncthing_package_names list\n- [ ] OS-specific package lists verified against upstream repositories","acceptance_criteria":"- [ ] roles/syncthing/vars/linux.yml created with syncthing packages\n- [ ] roles/syncthing/vars/debian.yml created with apt-specific package names (syncthing, syncthingtray)\n- [ ] roles/syncthing/vars/darwin.yml created with homebrew package names (syncthing, syncthing-gtk or equivalent)\n- [ ] Variables follow naming convention: syncthing_package_names list\n- [ ] OS-specific package lists verified against upstream repositories","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T13:56:36.720980341-08:00","updated_at":"2026-01-27T13:58:05.207390947-08:00","dependencies":[{"issue_id":"fleet-l98","depends_on_id":"fleet-c8a","type":"blocks","created_at":"2026-01-27T13:57:40.589793114-08:00","created_by":"daemon"},{"issue_id":"fleet-l98","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T13:57:45.136892493-08:00","created_by":"daemon"},{"issue_id":"fleet-l98","depends_on_id":"fleet-dzd","type":"blocks","created_at":"2026-01-27T14:06:17.538118272-08:00","created_by":"daemon"}]}
{"id":"fleet-lcb","title":"Create Darwin firewall integration test","description":"Create integration test playbook to verify Darwin firewall configuration for Syncthing.\n\n## Context\nThis is part of firewall integration testing (parent: fleet-11m). Tests Darwin-specific firewall configuration.\n\n## Implementation\n\nCreate `roles/syncthing/tests/test_darwin_firewall.yml`:\n\n- Test socketfilterfw status (if applicable)\n- Test application firewall allows Syncthing\n- Test port listening: lsof or netstat shows ports open\n- Test local connectivity: curl to 127.0.0.1:8384\n- Include role and run firewall tasks\n- Verify tasks are idempotent\n\n## Acceptance Criteria\n\n- [ ] test_darwin_firewall.yml created in roles/syncthing/tests/\n- [ ] Test runs only on Darwin hosts (ansible_facts.system == 'Darwin')\n- [ ] Test verifies application firewall configuration\n- [ ] Test verifies Syncthing app is allowed in firewall\n- [ ] Test verifies ports are listening using lsof or netstat\n- [ ] Test verifies Syncthing API is accessible (http://127.0.0.1:8384)\n- [ ] Test handles case where firewall is disabled (macOS often disables by default)\n- [ ] Test includes idempotency check (second run shows no changes)\n- [ ] Copyright header present\n- [ ] ansible-playbook --syntax-check passes\n- [ ] ansible-lint passes","status":"closed","priority":2,"issue_type":"task","owner":"kayos@genetikayos.com","created_at":"2026-01-27T15:13:43.414917337-08:00","created_by":"T.R. Fullhart","updated_at":"2026-01-27T15:39:22.676365725-08:00","closed_at":"2026-01-27T15:39:22.676365725-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["darwin","firewall","syncthing","testing"],"dependencies":[{"issue_id":"fleet-lcb","depends_on_id":"fleet-l6e","type":"blocks","created_at":"2026-01-27T15:13:59.313705457-08:00","created_by":"daemon"}]}
{"id":"fleet-li9","title":"Document connection types and troubleshooting","description":"Add connection types explanation and troubleshooting guide to Syncthing role README.\n\n## Context\nThis is part of firewall documentation (parent: fleet-y3k). Covers connection verification and troubleshooting.\n\n## Content to Add\n\nSections in roles/syncthing/README.md:\n\n### Connection Types\n- Explain direct connections (LAN)\n- Explain QUIC connections (faster NAT traversal)\n- Explain relay connections (fallback, slower)\n- Document how to verify connection types via web GUI\n- Document API endpoint for programmatic verification\n\n### Troubleshooting\n- Common issue: Firewall blocking despite configuration\n- Common issue: Relay connections instead of direct\n- Verification steps for each platform\n- How to check Syncthing logs\n- How to test connectivity with API\n\n## Acceptance Criteria\n\n- [ ] README.md section added: ### Connection Types\n- [ ] README.md section added: ### Troubleshooting\n- [ ] Direct connections explained with performance characteristics\n- [ ] QUIC connections explained with use case\n- [ ] Relay connections explained with fallback behavior\n- [ ] Web GUI verification steps documented\n- [ ] API verification endpoint documented (/rest/system/connections)\n- [ ] Common troubleshooting scenarios included (at least 3)\n- [ ] Platform-specific troubleshooting steps included\n- [ ] markdownlint passes on README.md","status":"closed","priority":2,"issue_type":"task","owner":"kayos@genetikayos.com","created_at":"2026-01-27T15:13:34.973250723-08:00","created_by":"T.R. Fullhart","updated_at":"2026-01-27T15:39:15.850656451-08:00","closed_at":"2026-01-27T15:39:15.850656451-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["documentation","firewall","syncthing"]}
{"id":"fleet-loh","title":"Apply templated config.xml to Syncthing instances","description":"Create Ansible task to apply templated config.xml to all Syncthing instances, backing up existing config first.\n\n## Implementation\n\nCreate `roles/syncthing/tasks/apply_config.yml`:\n\n```yaml\n# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\n---\n- name: \"Syncthing | Stop Syncthing service before config change\"\n  ansible.builtin.systemd_service:\n    name: \"syncthing@{{ user_name }}.service\"\n    state: stopped\n    scope: user\n  when: ansible_facts.system | lower == 'linux'\n\n- name: \"Syncthing | Backup existing config\"\n  ansible.builtin.copy:\n    src: \"{{ ansible_env.HOME }}/.config/syncthing/config.xml\"\n    dest: \"{{ ansible_env.HOME }}/.config/syncthing/config.xml.backup.{{ ansible_date_time.epoch }}\"\n    remote_src: true\n    mode: '0600'\n  when: syncthing_config_exists.stat.exists\n\n- name: \"Syncthing | Check if config exists\"\n  ansible.builtin.stat:\n    path: \"{{ ansible_env.HOME }}/.config/syncthing/config.xml\"\n  register: syncthing_config_exists\n\n- name: \"Syncthing | Apply templated config\"\n  ansible.builtin.template:\n    src: config.xml.j2\n    dest: \"{{ ansible_env.HOME }}/.config/syncthing/config.xml\"\n    owner: \"{{ user_name }}\"\n    mode: '0600'\n    backup: true\n  notify: restart syncthing\n\n- name: \"Syncthing | Validate config XML syntax\"\n  ansible.builtin.command:\n    cmd: xmllint --noout \"{{ ansible_env.HOME }}/.config/syncthing/config.xml\"\n  changed_when: false\n  failed_when: false\n  register: xmllint_result\n\n- name: \"Syncthing | Fail if config invalid\"\n  ansible.builtin.fail:\n    msg: \"Invalid XML syntax in config.xml\"\n  when: xmllint_result.rc != 0\n```\n\n## Acceptance Criteria\n\n- Task file created in roles/syncthing/tasks/\n- Existing config.xml backed up with timestamp\n- Templated config applied with correct ownership and permissions (0600)\n- XML syntax validated using xmllint before applying\n- Syncthing service stopped before config change (prevents corruption)\n- Handler notified to restart service after config change\n- Task fails safely if XML validation fails\n- Follows FQCN convention and copyright header\n- `ansible-lint` passes","acceptance_criteria":"- [ ] Ansible task created to apply config.xml.j2 template\n- [ ] Task uses `ansible.builtin.template` module\n- [ ] Template source: `roles/syncthing/templates/config.xml.j2`\n- [ ] Template destination: `~/.config/syncthing/config.xml` (Linux) or `~/Library/Application Support/Syncthing/config.xml` (Darwin)\n- [ ] Backup created before overwriting: `backup: yes` parameter\n- [ ] XML validation performed after templating: use `ansible.builtin.command` with `xmllint --noout`\n- [ ] Task notifies handler to restart Syncthing service\n- [ ] Runs only on hosts in laptop and workstation groups\n- [ ] Test run with --check shows config would be updated\n- [ ] Test run in execution mode successfully updates config on test hosts\n- [ ] Syncthing web GUI shows connected devices after config applied\n- [ ] ansible-lint passes on task file","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:28:29.93796574-08:00","updated_at":"2026-01-27T14:56:53.956477634-08:00","labels":["configuration","syncthing"],"dependencies":[{"issue_id":"fleet-loh","depends_on_id":"fleet-2w0","type":"blocks","created_at":"2026-01-27T14:28:29.951246606-08:00","created_by":"daemon"},{"issue_id":"fleet-loh","depends_on_id":"fleet-2w0","type":"parent-child","created_at":"2026-01-27T14:51:33.289445075-08:00","created_by":"daemon"}]}
{"id":"fleet-lqf","title":"Load device IDs from 1Password into hostvars","description":"Create Ansible task to load Syncthing device IDs from 1Password vault into hostvars for templating.\n\n## Implementation\n\nCreate `roles/syncthing/tasks/load_device_ids.yml`:\n\n```yaml\n# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\n---\n- name: \"Syncthing | Load device IDs from 1Password\"\n  ansible.builtin.set_fact:\n    syncthing_device_id: \"{{ lookup('ansible.builtin.pipe', 'op read \\\"op://ServiceAccountAccess/Syncthing Fleet Device IDs/' + inventory_hostname + '\\\"') }}\"\n  delegate_to: localhost\n  run_once: false\n\n- name: \"Syncthing | Verify device ID format\"\n  ansible.builtin.assert:\n    that:\n      - syncthing_device_id is defined\n      - syncthing_device_id | length == 63  # 52 chars + 11 dashes\n      - syncthing_device_id is match('^[A-Z0-9-]+$')\n    fail_msg: \"Invalid device ID format for {{ inventory_hostname }}: {{ syncthing_device_id }}\"\n    success_msg: \"Device ID loaded successfully for {{ inventory_hostname }}\"\n```\n\nIntegration in main tasks:\n```yaml\n# roles/syncthing/tasks/main.yml\n- name: \"Include device ID loading\"\n  ansible.builtin.include_tasks: load_device_ids.yml\n  when: syncthing_auto_pair | default(false)\n```\n\n## Acceptance Criteria\n\n- Task file created using lookup plugin for op CLI\n- Device IDs loaded into hostvars for all hosts\n- Device ID format validated (63 chars, alphanumeric + dashes)\n- Task fails gracefully if 1Password item missing or malformed\n- Task runs on localhost via delegate_to\n- Follows FQCN convention and copyright header\n- `ansible-lint` passes","acceptance_criteria":"- [ ] hostvars variable file created or group_vars updated for Syncthing device IDs\n- [ ] Uses `lookup('pipe', 'op read ...')` to fetch device IDs from 1Password\n- [ ] Variable structure supports all 5 hosts: `syncthing_fleet_devices`\n- [ ] Example: `syncthing_fleet_devices.rincewind` contains device ID\n- [ ] Device IDs loaded at playbook runtime (not hardcoded)\n- [ ] Fallback mechanism if 1Password read fails (fail task with clear message)\n- [ ] Test playbook can access device IDs: `{{ syncthing_fleet_devices[inventory_hostname] }}`\n- [ ] Variable documented in role defaults or group_vars with comments\n- [ ] ansible-lint passes on variable files","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:28:23.15823044-08:00","updated_at":"2026-01-27T14:56:50.399620573-08:00","labels":["1password","secrets-management","syncthing"],"dependencies":[{"issue_id":"fleet-lqf","depends_on_id":"fleet-2w0","type":"blocks","created_at":"2026-01-27T14:28:23.163843322-08:00","created_by":"daemon"},{"issue_id":"fleet-lqf","depends_on_id":"fleet-0g5","type":"blocks","created_at":"2026-01-27T14:29:07.355180997-08:00","created_by":"daemon"},{"issue_id":"fleet-lqf","depends_on_id":"fleet-2w0","type":"parent-child","created_at":"2026-01-27T14:51:32.80255672-08:00","created_by":"daemon"}]}
{"id":"fleet-m94","title":"Create cross-platform firewall integration test","description":"## Context\nThis subtask is part of fleet-11m (Create integration test for Syncthing firewall configuration). It requires both Linux and Darwin platform tests to pass first, then verifies connectivity between mixed-platform hosts.\n\n## Objective\nCreate an Ansible test playbook that verifies Syncthing can establish direct connections between Linux and Darwin hosts, confirming cross-platform firewall compatibility.\n\n## Test Coverage\n1. **Mixed Platform Connectivity**: Test rincewind (Linux)  constantine (Darwin)\n2. **Connection Types**: Verify all connections are direct/QUIC (not relay)\n3. **Bi-directional**: Ensure both hosts can initiate connections\n4. **Discovery**: Verify local discovery works across platforms\n\n## Implementation Location\n`roles/syncthing/tests/test_cross_platform_firewall.yml`\n\n## Acceptance Criteria\n1. Test playbook created at specified location\n2. Targets both test hosts (rincewind, constantine)\n3. Includes platform-specific firewall tests dynamically\n4. Uses connection type verification task to check peer connections\n5. Verifies rincewindconstantine connection is direct/QUIC\n6. Verifies constantinerincewind connection is direct/QUIC\n7. Tests local discovery between platforms (port 21027 UDP)\n8. Uses `ansible.builtin.assert` for all validations\n9. Provides clear failure messages with peer details\n10. Follows FQCN convention\n11. Includes copyright header\n12. Passes ansible-lint validation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-27T15:17:15.046725881-08:00","updated_at":"2026-01-27T15:39:17.419102036-08:00","closed_at":"2026-01-27T15:39:17.419102036-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["firewall","integration","syncthing","testing"],"dependencies":[{"issue_id":"fleet-m94","depends_on_id":"fleet-4up","type":"blocks","created_at":"2026-01-27T15:17:26.476893253-08:00","created_by":"daemon"},{"issue_id":"fleet-m94","depends_on_id":"fleet-3ck","type":"blocks","created_at":"2026-01-27T15:17:26.971926877-08:00","created_by":"daemon"}]}
{"id":"fleet-mtd","title":"Implement Linux service enablement for syncthing","description":"Create Linux-specific task file to enable and start the Syncthing user systemd service. Syncthing runs as a user service (syncthing@username.service) not a system service.\n\n**Important:** Use `scope: user` in ansible.builtin.systemd_service module to manage user-level services.\n\n## Acceptance Criteria\n\n- [ ] roles/syncthing/tasks/linux_enable_service.yml created\n- [ ] Uses ansible.builtin.systemd_service (user service) with FQCN\n- [ ] Enables syncthing@{{ user_name }}.service\n- [ ] Starts syncthing@{{ user_name }}.service\n- [ ] Uses scope: user for user-level systemd service\n- [ ] Includes proper task naming and copyright header","acceptance_criteria":"- [ ] roles/syncthing/tasks/linux_enable_service.yml created\n- [ ] Uses ansible.builtin.systemd_service (user service) with FQCN\n- [ ] Enables syncthing@{{ user_name }}.service\n- [ ] Starts syncthing@{{ user_name }}.service\n- [ ] Uses scope: user for user-level systemd service\n- [ ] Includes proper task naming and copyright header","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T13:56:52.576056333-08:00","updated_at":"2026-01-27T13:58:07.880720468-08:00","dependencies":[{"issue_id":"fleet-mtd","depends_on_id":"fleet-4j8","type":"blocks","created_at":"2026-01-27T13:57:40.690908621-08:00","created_by":"daemon"},{"issue_id":"fleet-mtd","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T13:57:46.817492585-08:00","created_by":"daemon"}]}
{"id":"fleet-n9m","title":"Create test playbook for syncthing role","description":"Create the test playbook and inventory for validating the syncthing role independently. This allows check mode testing without modifying the system.\n\nReference: `roles/base/tests/test.yml` and other role test patterns.\n\nFiles to create:\n- `roles/syncthing/tests/test.yml` - Playbook that applies the role\n- `roles/syncthing/tests/inventory` - Simple inventory with localhost\n\n## Acceptance Criteria\n\n- [ ] `roles/syncthing/tests/test.yml` created with proper playbook structure\n- [ ] `roles/syncthing/tests/inventory` created with localhost target\n- [ ] Test playbook applies syncthing role in check mode\n- [ ] Test playbook can run independently\n- [ ] Follows existing test patterns from other roles","acceptance_criteria":"- [ ] `roles/syncthing/tests/test.yml` created with proper playbook structure\n- [ ] `roles/syncthing/tests/inventory` created with localhost target\n- [ ] Test playbook applies syncthing role in check mode\n- [ ] Test playbook can run independently\n- [ ] Follows existing test patterns from other roles","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T13:57:08.518071716-08:00","updated_at":"2026-01-27T14:06:29.840255276-08:00","dependencies":[{"issue_id":"fleet-n9m","depends_on_id":"fleet-hef","type":"blocks","created_at":"2026-01-27T13:57:40.817942707-08:00","created_by":"daemon"},{"issue_id":"fleet-n9m","depends_on_id":"fleet-4g6","type":"parent-child","created_at":"2026-01-27T13:57:48.182523186-08:00","created_by":"daemon"}]}
{"id":"fleet-nkn","title":"Research Crush LSP configuration","description":"Read https://github.com/charmbracelet/crush documentation to determine how to configure LSP servers.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T16:01:25.68321131-08:00","created_by":"kayos","updated_at":"2026-01-06T16:01:40.231566155-08:00","closed_at":"2026-01-06T16:01:40.231588614-08:00"}
{"id":"fleet-nz6","title":"Create playbook to orchestrate auto-pairing workflow","description":"Create dedicated Ansible playbook to orchestrate device ID collection, storage, and config templating across fleet.\n\n## Implementation\n\nCreate `syncthing_autopair.yml` in repository root:\n\n```yaml\n---\n- name: \"Syncthing Auto-Pairing Setup\"\n  hosts: laptop:workstation\n  become: false\n  gather_facts: true\n  \n  tasks:\n    - name: \"Collect device IDs from all hosts\"\n      ansible.builtin.include_role:\n        name: syncthing\n        tasks_from: collect_device_ids.yml\n      tags: [collect]\n    \n    - name: \"Store device IDs in 1Password\"\n      ansible.builtin.include_role:\n        name: syncthing\n        tasks_from: store_device_ids.yml\n      run_once: true\n      delegate_to: localhost\n      tags: [store]\n\n- name: \"Apply Syncthing configuration\"\n  hosts: laptop:workstation\n  become: false\n  gather_facts: true\n  \n  tasks:\n    - name: \"Load device IDs from 1Password\"\n      ansible.builtin.include_role:\n        name: syncthing\n        tasks_from: load_device_ids.yml\n      tags: [configure]\n    \n    - name: \"Apply templated config\"\n      ansible.builtin.include_role:\n        name: syncthing\n        tasks_from: apply_config.yml\n      tags: [configure]\n  \n  handlers:\n    - name: restart syncthing\n      ansible.builtin.include_role:\n        name: syncthing\n        handlers_from: main.yml\n```\n\nAdd mise task in `mise.toml`:\n```toml\n[tasks.\"syncthing:autopair\"]\ndescription = \"Configure Syncthing auto-pairing across fleet\"\nrun = \"\"\"\nansible-playbook syncthing_autopair.yml -l laptop:workstation\n\"\"\"\n```\n\n## Acceptance Criteria\n\n- Playbook created in repository root\n- Two-phase approach: collection/storage, then configuration\n- Targets only laptop and workstation groups\n- Uses role tasks via include_role\n- Tags enable selective execution (collect, store, configure)\n- Mise task created for easy execution\n- Playbook documented in project README\n- `ansible-playbook syncthing_autopair.yml --syntax-check` passes\n- `ansible-lint syncthing_autopair.yml` passes","acceptance_criteria":"- [ ] syncthing_autopair.yml playbook created in repository root\n- [ ] Playbook has two distinct plays: collection/storage and configuration\n- [ ] First play targets laptop:workstation groups\n- [ ] First play includes device ID collection and 1Password storage tasks\n- [ ] Second play includes config loading and application tasks\n- [ ] Playbook uses tags for selective execution (collect, store, configure)\n- [ ] mise.toml updated with syncthing:autopair task definition\n- [ ] mise run syncthing:autopair executes successfully\n- [ ] ansible-playbook syncthing_autopair.yml --syntax-check passes\n- [ ] ansible-lint syncthing_autopair.yml passes\n- [ ] Playbook documented in project README or AGENTS.md","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:28:41.953610137-08:00","updated_at":"2026-01-27T15:09:13.813879994-08:00","labels":["orchestration","syncthing"],"dependencies":[{"issue_id":"fleet-nz6","depends_on_id":"fleet-2w0","type":"blocks","created_at":"2026-01-27T14:28:41.958092218-08:00","created_by":"daemon"},{"issue_id":"fleet-nz6","depends_on_id":"fleet-st4","type":"blocks","created_at":"2026-01-27T14:29:08.929763606-08:00","created_by":"daemon"},{"issue_id":"fleet-nz6","depends_on_id":"fleet-0g5","type":"blocks","created_at":"2026-01-27T14:29:09.509128019-08:00","created_by":"daemon"},{"issue_id":"fleet-nz6","depends_on_id":"fleet-75d","type":"blocks","created_at":"2026-01-27T14:29:10.038392996-08:00","created_by":"daemon"},{"issue_id":"fleet-nz6","depends_on_id":"fleet-lqf","type":"blocks","created_at":"2026-01-27T14:29:10.523285171-08:00","created_by":"daemon"},{"issue_id":"fleet-nz6","depends_on_id":"fleet-loh","type":"blocks","created_at":"2026-01-27T14:29:11.063856996-08:00","created_by":"daemon"},{"issue_id":"fleet-nz6","depends_on_id":"fleet-c3u","type":"blocks","created_at":"2026-01-27T14:29:11.510240085-08:00","created_by":"daemon"},{"issue_id":"fleet-nz6","depends_on_id":"fleet-2w0","type":"parent-child","created_at":"2026-01-27T14:51:34.212140039-08:00","created_by":"daemon"}]}
{"id":"fleet-pr6","title":"Document firewall setup and port configuration","description":"Add firewall configuration section to Syncthing role README explaining ports, setup, and platform differences.\n\n## Context\nThis is part of firewall documentation (parent: fleet-y3k). Covers setup and configuration basics.\n\n## Content to Add\n\nSection in roles/syncthing/README.md:\n\n### Firewall Configuration\n- Explain automatic firewall configuration by role\n- Document ports: TCP 22000 (sync), UDP 22000 (QUIC), UDP 21027 (discovery)\n- Explain Linux ufw configuration (tasks/linux_firewall.yml)\n- Explain Darwin firewall configuration (tasks/darwin_firewall.yml)\n- Note platform-specific commands for manual verification\n\n## Acceptance Criteria\n\n- [ ] README.md section added: ## Firewall Configuration\n- [ ] Port 22000 TCP documented: primary sync protocol\n- [ ] Port 22000 UDP documented: QUIC protocol for NAT traversal\n- [ ] Port 21027 UDP documented: local discovery\n- [ ] Linux ufw configuration process documented\n- [ ] Darwin firewall configuration process documented\n- [ ] Manual verification commands included for both platforms\n- [ ] Section explains why firewall configuration is necessary (direct vs relay)\n- [ ] markdownlint passes on README.md","status":"closed","priority":2,"issue_type":"task","owner":"kayos@genetikayos.com","created_at":"2026-01-27T15:13:30.513054988-08:00","created_by":"T.R. Fullhart","updated_at":"2026-01-27T15:39:22.352606447-08:00","closed_at":"2026-01-27T15:39:22.352606447-08:00","close_reason":"Task created incorrectly without acceptance criteria during decomposition attempt. Intermediate parent tasks (fleet-0mw, fleet-y3k, fleet-11m) should be completed as-is without further decomposition.","labels":["documentation","firewall","syncthing"],"dependencies":[{"issue_id":"fleet-pr6","depends_on_id":"fleet-li9","type":"blocks","created_at":"2026-01-27T15:13:56.03687869-08:00","created_by":"daemon"}]}
{"id":"fleet-qwr","title":"Test computed fields bug","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] Task works\n- [ ] Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"kayos@genetikayos.com","created_at":"2026-01-27T15:58:57.91967924-08:00","created_by":"T.R. Fullhart","updated_at":"2026-01-27T15:59:02.448607853-08:00","closed_at":"2026-01-27T15:59:02.448607853-08:00","close_reason":"Test complete - bug confirmed"}
{"id":"fleet-s0l","title":"Setup beads for fleet project","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:17:06.27468446-08:00","created_by":"kayos","updated_at":"2026-01-06T15:25:28.938259855-08:00","closed_at":"2026-01-06T15:25:28.938259855-08:00","close_reason":"Closed"}
{"id":"fleet-st4","title":"Collect Syncthing device IDs from fleet hosts","description":"Create Ansible task to collect Syncthing device IDs from all running instances in the fleet.\n\n## Implementation\n\nCreate `roles/syncthing/tasks/collect_device_ids.yml`:\n\n```yaml\n# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\n---\n- name: \"Syncthing | Get device ID from config\"\n  ansible.builtin.slurp:\n    src: \"{{ ansible_env.HOME }}/.config/syncthing/config.xml\"\n  register: syncthing_config_raw\n\n- name: \"Syncthing | Parse device ID\"\n  ansible.builtin.set_fact:\n    syncthing_device_id: \"{{ syncthing_config_raw.content | b64decode | regex_search('\u003cdevice id=\\\"([A-Z0-9-]+)\\\"', '\\\\1') | first }}\"\n\n- name: \"Syncthing | Display device ID\"\n  ansible.builtin.debug:\n    msg: \"{{ inventory_hostname }}: {{ syncthing_device_id }}\"\n```\n\nAlternative approach using REST API (if API key available):\n```yaml\n- name: \"Syncthing | Get device ID via API\"\n  ansible.builtin.uri:\n    url: \"http://localhost:8384/rest/system/status\"\n    headers:\n      X-API-Key: \"{{ syncthing_api_key }}\"\n  register: syncthing_status\n\n- name: \"Syncthing | Set device ID fact\"\n  ansible.builtin.set_fact:\n    syncthing_device_id: \"{{ syncthing_status.json.myID }}\"\n```\n\n## Acceptance Criteria\n\n- Task file created in roles/syncthing/tasks/\n- Device IDs successfully extracted from all 5 hosts\n- Device IDs stored in Ansible facts for later use\n- Task handles missing config.xml gracefully (fail with clear message)\n- Follows FQCN convention and copyright header\n- `ansible-lint` passes","acceptance_criteria":"- [ ] Ansible task created to collect device IDs from Syncthing instances\n- [ ] Task uses `ansible.builtin.uri` to query REST API at `http://127.0.0.1:8384/rest/system/status`\n- [ ] API key read from Syncthing config.xml using `ansible.builtin.slurp` or `ansible.builtin.xml`\n- [ ] Device ID extracted from JSON response: `.myID` field\n- [ ] Device ID registered to fact: `syncthing_device_id`\n- [ ] Task runs only on hosts in laptop and workstation groups\n- [ ] Task fails gracefully if Syncthing not running or API unreachable\n- [ ] ansible-lint passes on task file\n- [ ] Test run with --check and --diff shows device IDs would be collected","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:27:58.96013127-08:00","updated_at":"2026-01-27T14:56:41.490246829-08:00","labels":["data-collection","syncthing"],"dependencies":[{"issue_id":"fleet-st4","depends_on_id":"fleet-2w0","type":"blocks","created_at":"2026-01-27T14:27:58.964939437-08:00","created_by":"daemon"},{"issue_id":"fleet-st4","depends_on_id":"fleet-2w0","type":"parent-child","created_at":"2026-01-27T14:51:30.704235787-08:00","created_by":"daemon"}]}
{"id":"fleet-t6i","title":"Test computed fields bug","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] Issue description clarified with context and purpose\n- [ ] Task implementation details added if technical work required\n- [ ] Title updated to be specific and actionable\n- [ ] Task can be understood and executed without additional context","status":"open","priority":2,"issue_type":"task","owner":"kayos@genetikayos.com","created_at":"2026-01-27T15:58:54.39432166-08:00","created_by":"T.R. Fullhart","updated_at":"2026-01-27T19:33:36.431749677-08:00"}
{"id":"fleet-tb6","title":"Implement blender installation in printing_3d role","description":"Found TODO in roles/printing_3d/tasks/main.yml: install blender","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:36:45.185121438-08:00","created_by":"kayos","updated_at":"2026-01-07T17:02:25.222282362-08:00","closed_at":"2026-01-07T17:02:25.222282362-08:00","close_reason":"Added blender to printing_3d_packages"}
{"id":"fleet-y0c","title":"Configure Crush to use Ansible Language Server","description":"Ensure Crush is configured to utilize the installed @ansible/ansible-language-server for better Ansible file intelligence.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:48:45.150530349-08:00","created_by":"kayos","updated_at":"2026-01-06T15:53:06.983581693-08:00","closed_at":"2026-01-06T15:53:06.983593651-08:00"}
{"id":"fleet-y3k","title":"Document firewall configuration in Syncthing role README","description":"Update `roles/syncthing/README.md` to document firewall configuration, ports, connection types, and troubleshooting.\n\n## Content to Add\n\n### Section: Firewall Configuration\n\n```markdown\n## Firewall Configuration\n\nThis role automatically configures host firewalls to allow Syncthing traffic. This ensures direct peer-to-peer connections instead of falling back to slower relay servers.\n\n### Ports\n\n- **TCP 22000**: Primary sync protocol\n- **UDP 22000**: QUIC protocol (faster NAT traversal)\n- **UDP 21027**: Local network discovery\n- **TCP 8384**: Web GUI (localhost only, not opened in firewall)\n\n### Platforms\n\n#### Linux (ufw)\n\nThe role configures three ufw rules:\n```bash\nufw allow 22000/tcp comment 'Syncthing sync protocol (TCP)'\nufw allow 22000/udp comment 'Syncthing sync protocol (QUIC)'\nufw allow 21027/udp comment 'Syncthing local discovery'\n```\n\nBoth IPv4 and IPv6 are supported automatically.\n\n#### Darwin (macOS)\n\nThe role adds Syncthing to the application firewall allow list:\n```bash\n/usr/libexec/ApplicationFirewall/socketfilterfw --add /opt/homebrew/bin/syncthing\n/usr/libexec/ApplicationFirewall/socketfilterfw --unblockapp /opt/homebrew/bin/syncthing\n```\n\n### Variables\n\n- `syncthing_configure_firewall`: Enable/disable firewall configuration (default: `true`)\n- `syncthing_validate_ports`: Validate ports are listening after configuration (default: `true`)\n- `syncthing_test_connectivity`: Test connectivity to peers (default: `false`)\n- `syncthing_verify_connections`: Verify direct connections via API (default: `false`)\n\n### Connection Types\n\nSyncthing uses multiple connection methods with fallback:\n1. **Direct TCP** - Fastest, lowest latency\n2. **Direct QUIC** - Fast with better NAT traversal\n3. **Relay Servers** - Fallback when direct connections fail (slowest)\n\nAfter firewall configuration, verify connection types:\n```bash\ncurl -H \"X-API-Key: YOUR_API_KEY\" http://localhost:8384/rest/system/connections | jq\n```\n\nLook for `type` field:\n- `tcp-client`, `tcp-server`, `quic-client`, `quic-server` = Direct (optimal)\n- `relay-*` = Relay connection (suboptimal, check firewall)\n\n### Troubleshooting\n\n#### Relay connections after firewall configuration\n\n1. Check firewall rules are applied:\n   ```bash\n   # Linux\n   sudo ufw status verbose\n   \n   # macOS\n   /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate\n   ```\n\n2. Verify ports are listening:\n   ```bash\n   # Linux\n   ss -tlnp | grep 22000\n   ss -ulnp | grep 22000\n   \n   # macOS\n   netstat -an | grep 22000\n   ```\n\n3. Check router/gateway firewall (manual configuration required)\n4. Verify UPnP is enabled on router\n5. Check ZeroTier/VPN firewall rules if applicable\n\n#### Port conflicts\n\nIf port 22000 is already in use:\n- Edit Syncthing config: `~/.config/syncthing/config.xml`\n- Change `\u003clistenAddress\u003e` port\n- Update firewall rules accordingly\n```\n\n## Integration\n\nAdd new section after \"Usage\" section in existing README.","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] README.md section \"## Firewall Configuration\" added\n- [ ] Linux (ufw) configuration documented with port numbers and purposes\n- [ ] Darwin (socketfilterfw) configuration documented\n- [ ] Port table included: TCP 22000 (sync), UDP 22000 (QUIC), UDP 21027 (discovery)\n- [ ] Connection types explained (direct TCP, QUIC, relay)\n- [ ] Troubleshooting section for firewall issues included\n- [ ] Examples for manual verification commands provided\n- [ ] Variables documented (syncthing_configure_firewall, syncthing_validate_ports, etc.)\n- [ ] Section placed after \"Usage\" section in README\n- [ ] `mise run lint:markdown` passes","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:46:53.101489911-08:00","updated_at":"2026-01-27T19:33:38.701282967-08:00","labels":["documentation","syncthing"],"dependencies":[{"issue_id":"fleet-y3k","depends_on_id":"fleet-ccd","type":"blocks","created_at":"2026-01-27T14:46:53.105965573-08:00","created_by":"daemon"},{"issue_id":"fleet-y3k","depends_on_id":"fleet-ccd","type":"parent-child","created_at":"2026-01-27T14:49:03.958874108-08:00","created_by":"daemon"},{"issue_id":"fleet-y3k","depends_on_id":"fleet-pr6","type":"parent-child","created_at":"2026-01-27T15:13:54.727508343-08:00","created_by":"daemon"},{"issue_id":"fleet-y3k","depends_on_id":"fleet-li9","type":"parent-child","created_at":"2026-01-27T15:13:55.370435134-08:00","created_by":"daemon"},{"issue_id":"fleet-y3k","depends_on_id":"fleet-5y5","type":"parent-child","created_at":"2026-01-27T15:17:20.06835768-08:00","created_by":"daemon"},{"issue_id":"fleet-y3k","depends_on_id":"fleet-d6a","type":"parent-child","created_at":"2026-01-27T15:17:20.548603273-08:00","created_by":"daemon"}]}
{"id":"fleet-ylc","title":"setup oh-my-zsh with completions for the bd tool","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T16:22:13.732633627-08:00","created_by":"kayos","updated_at":"2026-01-08T11:52:41.067249645-08:00","closed_at":"2026-01-07T16:33:27.49704301-08:00"}
{"id":"fleet-zmb","title":"Configure Linux ufw rules for Syncthing ports","description":"Create Ansible task to configure ufw firewall rules for Syncthing on Linux hosts.\n\n## Implementation\n\nCreate `roles/syncthing/tasks/linux_configure_firewall.yml`:\n\n```yaml\n# Copyright (c) 2026 T.R. Fullhart. All Rights Reserved.\n---\n- name: \"Syncthing | Allow TCP sync traffic (port 22000)\"\n  community.general.ufw:\n    rule: allow\n    port: '22000'\n    proto: tcp\n    comment: 'Syncthing sync protocol (TCP)'\n  become: true\n\n- name: \"Syncthing | Allow QUIC sync traffic (port 22000/UDP)\"\n  community.general.ufw:\n    rule: allow\n    port: '22000'\n    proto: udp\n    comment: 'Syncthing sync protocol (QUIC)'\n  become: true\n\n- name: \"Syncthing | Allow local discovery (port 21027/UDP)\"\n  community.general.ufw:\n    rule: allow\n    port: '21027'\n    proto: udp\n    comment: 'Syncthing local discovery'\n  become: true\n\n- name: \"Syncthing | Enable ufw if not enabled\"\n  community.general.ufw:\n    state: enabled\n  become: true\n  when: syncthing_enable_ufw | default(false)\n```\n\nIntegration in `roles/syncthing/tasks/main.yml`:\n```yaml\n- name: \"Include firewall configuration\"\n  ansible.builtin.include_tasks: \"{{ ansible_facts.system | lower }}_configure_firewall.yml\"\n  when: syncthing_configure_firewall | default(true)\n```\n\nAdd to `roles/syncthing/defaults/main.yml`:\n```yaml\nsyncthing_configure_firewall: true\nsyncthing_enable_ufw: false  # Don't auto-enable ufw, assume already configured\n```","acceptance_criteria":"## Acceptance Criteria\n\n- [ ] Task file `roles/syncthing/tasks/linux_configure_firewall.yml` created\n- [ ] Task configures ufw rule for TCP port 22000 with comment \"Syncthing sync protocol (TCP)\"\n- [ ] Task configures ufw rule for UDP port 22000 with comment \"Syncthing sync protocol (QUIC)\"\n- [ ] Task configures ufw rule for UDP port 21027 with comment \"Syncthing local discovery\"\n- [ ] All rules use community.general.ufw module\n- [ ] Task runs with become: true (requires sudo)\n- [ ] Rules are idempotent (can run multiple times)\n- [ ] Variable `syncthing_configure_firewall` added to defaults (default: true)\n- [ ] Copyright header present\n- [ ] `ansible-lint` passes\n- [ ] `mise run lint` passes","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T14:45:13.265071404-08:00","updated_at":"2026-01-27T19:33:50.109261305-08:00","labels":["firewall","linux","syncthing","ufw"],"dependencies":[{"issue_id":"fleet-zmb","depends_on_id":"fleet-ccd","type":"blocks","created_at":"2026-01-27T14:45:13.270897494-08:00","created_by":"daemon"},{"issue_id":"fleet-zmb","depends_on_id":"fleet-ccd","type":"parent-child","created_at":"2026-01-27T14:49:01.427078335-08:00","created_by":"daemon"}]}
